{"version":3,"file":"bolt.min.js","mappings":"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","sources":["webpack://webpack/./src/bolt.js"],"sourcesContent":["/*\r\n    init object\r\n    init persistent store\r\n    add request params to store for immediate use in hydrate \r\n    add data to persistent store manually to passs data via xhr\r\n    xhr rest call to get all data for this page\r\n\r\n    hydrate all dom elements \r\n    hydrate all templates\r\n\r\non initial load set any classes to easily set as reactive \r\n    bind dom elements; make reactive\r\n    handle actions: upper, lower, copy, encrypt, etc. allow chained actions\r\n\r\n    handle post forms, links, \r\n\r\n    what else significant is in bolt.js\r\n\r\n//########################################\r\nTODO\r\nBOLT.JS\r\nHANDLE CHANGE EVENTS: upper, lower, encrypt, sanitize, clone\r\nHANDLE CLICK EVENTS: callbefore, xhr, callback; as promises and queued\r\nMODALS AND TEMPLATES\r\nUPDATES TO CRUD OBJECTS FROM LOCAL DATASETS\r\n\r\nFRANKENSITE DESIGNER\r\nWYSIWYG: HEADER, FOOTER, BODY, MODAL, TEMPLATES\r\nPAGE OVERVIEW; CAN PAGES BE HIGHLIGHTED WHEN PARAMETERS REQUIRED, LIKE CLIENT GUID, TO RENDER PAGE; OR DOES THIS NEED TO BE DONE MANUALLY\r\n  CAN PARAMETERS BE READ FROM ALL XHR CALLS ON PAGE TO SEE IF ANY NON GENERIC PARAMETERS EXIST; SESSION GUID IS AN EXAMPLE OF GENERIC\r\n\r\nDATABASE MANAGEMENT\r\nOBJECTS CREATE CUSTOM SCHEMA TABLES\r\n  CRUD FOR EVERY OBJECT/TABLE\r\n  ADMIN TO MANAGE OBJECTS: NAME/ALIAS, DATATYPE, ENCRYPT, PRIMARY KEY\r\n    HELPER TO CREATE OBJECT FROM FORM CONTAINERS ON FRANKENSITE DESIGNER; GET ALL FIELDS, INCLUDE HIDDEN/CLONED FIELDS\r\n    AUTO POPULATE OBJECT VALUES, OPTION TO EDIT\r\n    ################################################################################################################################################################\r\n    ANY XHR CALL MUST HAVE EXISTING OBJECT\r\n    MESSAGE IF OBJECT BEING CHANGED TO NOT CAPTURE FIELD ON FORM\r\n    FIELD DECLARED BUT NEVER USED; SHOW MESSAGE IN LAYMANS TERMS\r\n    ################################################################################################################################################################\r\n  INDEXES\r\n  UI TO LINK JOIN TABLES ON PRIMARY KEY; AUTO CREATE CRUD FOR JOINED TABLES\r\n  PROCEDURE MANAGER TO SEE ALL AVAILABLE API CALLS; CREATE NEW CUSTOM API CALL MODIFIED FROM EXISTING TO REDUCE RESULTS; AUTO INCLUDE ID\r\n\r\nAND REALLY USE JWT\r\nOPTION TO BUILD PAGE SERVER SIDE RATHER THAN CLIENT SIDE VIA XHR\r\n\r\n\r\nobserver to disable/enable, hide/show\r\n  could be bool/conditional\r\n*/\r\nvar classRnd = Math.random().toString(36).slice(2);\r\n\r\n\r\n//########################################\r\n//_rex object; object to manage and store all data; referenced by framework object\r\n//########################################\r\nvar _rex = function () {\r\n  return {\r\n    all: function () {\r\n      return JSON.parse(JSON.stringify(this.datasets));\r\n    },\r\n    datasets: {\r\n      store: {}, persistent: { \"meta\": {\"object\":\"true\"}}\r\n    },\r\n    meta: {\r\n      history: {}\r\n    },\r\n    create: function (type, name, args) { return null },\r\n    read: function () { return null },\r\n    update: function () { return null },\r\n    delete: function () { return null },\r\n    alterTable: function () { return null },\r\n    load: function (dataset) {\r\n      this.datasets = JSON.parse(dataset)\r\n    },\r\n    unload: function () {\r\n      this.datasets = { store: {} };\r\n    },\r\n    where: function () { return null },\r\n    save: function () { return null }\r\n  };\r\n}();\r\n\r\n//########################################\r\n//_r object; reactive store\r\n//########################################\r\nvar rhandler = {\r\n  get(target, key, receiver) {\r\n    if (typeof target[key] === 'object' && target[key] !== null) {\r\n      return new Proxy(target[key], rhandler)\r\n    } else {\r\n      return Reflect.get(target, key, receiver);//is this necessary\r\n    }\r\n  },\r\n  set(target, key, value, receiver) {\r\n    return Reflect.set(target.datasets, key, value, receiver.datasets.store);\r\n  },\r\n  apply(target, thisArg, args) {\r\n    return target(...args);\r\n  }\r\n}\r\nconst _r = new Proxy(_rex, rhandler);\r\n//########################################\r\n\r\n//########################################\r\n//db object\r\n//########################################\r\nvar dbhandler = {\r\n  get(target, key, receiver) {\r\n    if (typeof target[key] === 'object' && target[key] !== null) {\r\n      return new Proxy(target[key], dbhandler)\r\n    } else {\r\n      return Reflect.get(target, key, receiver);\r\n    }\r\n  },\r\n  set(target, key, value, receiver) {\r\n    Reflect.set(target, key, value, receiver);\r\n  },\r\n  apply(target, thisArg, args) {\r\n    return target(...args);\r\n  }\r\n}\r\n\r\nvar db = new Proxy(_rex, dbhandler);\r\n//add request params (_requestparams) to store; store is just name value pairs\r\nfunction all() { return this.data }\r\ndb.datasets.store.all = all;\r\ndb.datasets.store.meta = { \"object\": \"true\" };\r\n//console.log('_requestparams', _requestparams);\r\ndb.datasets.store.data = [_requestparams];\r\n\r\ndb.meta.history.all = all;\r\ndb.meta.history.pointer = null;\r\ndb.meta.history.data = [];\r\n\r\n//console.log(_rex.datasets.store.data[0]);\r\n_rex.datasets.persistent.data = (typeof _rex.datasets.store.data[0] !== 'undefined') ? _rex.datasets.store.data  : [];\r\n//for (let item of _persistent) {\r\n//  _rex.datasets.persistent.data[item] = (typeof _rex.datasets.store.data[0][item] !== 'undefined') ? _rex.datasets.store.data[0][item] : '';\r\n//}\r\n//for (let item of _persistent) {\r\n//  _rex.datasets.persistent[item] = _rex.datasets.store[item];\r\n//}\r\n\r\n\r\n/*\r\n takes add request params to store\r\n manually include persistent params \r\n auto include params deemed persistent by server\r\n prevent duplicates\r\n\r\npopulate observe elements\r\ncreate and populate any forms from data-bind/submit-xhr-post etc.\r\n  could be populating existing values such as client overview\r\n_rex.forms[formname].data\r\n_rex.forms[formname].history\r\n_rex.forms[formname].meta\r\n\r\ninclude _rex.forms with post based on data-bind forms\r\n\r\nshould datasets be managed; CRUD \r\nlike service categories to update and refresh\r\n  changes to service category dataset should update dropdown list \r\nhandle dataset paging\r\n */\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//data-observe objects reactively populate data\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\n//IS THIS CODE REDUNDANT?\r\n/*\r\n \r\nvar elements = document.querySelectorAll('[data-observe]'); // All with attribute named \"property\"\r\nfor (let element of elements) {\r\n  //console.log('element', element);\r\n  let observe = element.getAttribute('data-observe');\r\n  console.log('observe', observe);\r\n\r\n  //object could be an array of items to hydrate of which html is only one\r\n  //need to loop over all items\r\n  var obj = JSON.parse(observe)[0];\r\n  console.log('obj.type', obj);\r\n  var _store = 'store';\r\n  if (typeof obj.src !== 'undefined') {\r\n    _store = obj.src;\r\n  }\r\n\r\n  switch (obj.type) {\r\n    case 'html':\r\n      var field = obj.value;\r\n      console.log(db.all());\r\n      console.log(_store, field);\r\n      console.log(db.datasets[_store]);\r\n      console.log('%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%');\r\n      console.log('%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%');\r\n      if (db.datasets[_store].length > 1) {\r\n        element.innerHTML = db.datasets[_store][0][field];\r\n      } else {\r\n        element.innerHTML = db.datasets[_store][field];\r\n      }\r\n      element.classList.add(obj.value);\r\n      break;\r\n  }\r\n}\r\n\r\n\r\n//end reactive watchers/observed\r\n */\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//OBSERVABLE\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\nclass Observable {\r\n\r\n  constructor(functionThatTakesObserver) {\r\n    this.functionThatTakesObserver = functionThatTakesObserver;\r\n  }\r\n\r\n  subscribe(observer) {\r\n    return this.functionThatTakesObserver(observer)\r\n  }\r\n\r\n\r\n\r\n  map(projectionFunction) {\r\n    return new Observable(observer => {\r\n      return this.subscribe({\r\n        next(val) { observer.next(projectionFunction(val)) },\r\n        error(e) { observer.error(e) },\r\n        complete() { observer.complete() }\r\n      });\r\n    });\r\n  }\r\n\r\n  mergeMap(anotherFunctionThatThrowsValues) {\r\n    return new Observable(observer => {\r\n      return this.subscribe({\r\n        next(val) {\r\n          anotherFunctionThatThrowsValues(val).subscribe({\r\n            next(val) { observer.next(val) },\r\n            error(e) { observer.error(e) },\r\n            complete() { observer.complete() }\r\n          });\r\n        },\r\n        error(e) { observer.error(e) },\r\n        complete() { observer.complete() }\r\n      });\r\n    });\r\n  }\r\n\r\n  static fromArray(array) {\r\n    return new Observable(observer => {\r\n      array.forEach(val => observer.next(val));\r\n      observer.complete();\r\n    });\r\n  }\r\n\r\n  static fromEvent(element, event) {\r\n    return new Observable(observer => {\r\n      const handler = (e) => observer.next(e);\r\n      element.addEventListener(event, handler);\r\n      observer.complete();\r\n      return () => {\r\n        element.removeEventListener(event, handler);\r\n      };\r\n    });\r\n  }\r\n\r\n  static fromPromise(promise) {\r\n    return new Observable(observer => {\r\n      promise.then(val => {\r\n        observer.next(val); observer.complete();\r\n      })\r\n        .catch(e => {\r\n          observer.error(val); observer.complete();\r\n        });\r\n    })\r\n  }\r\n}\r\n//END OBSERVABLE\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\n\r\nfunction modifyText() {\r\n  console.log('clicked');\r\n}\r\n\r\n\r\nif (false) {\r\n//allows comments to be collapsed\r\n//var views = document.querySelectorAll('span'); // All with attribute named \"property\"\r\n\r\n//console.log(views);\r\n//for (let view of views) {\r\n//  views.addEventListener(\"click\", console.log('clicked'));\r\n//}\r\n//let viewClick = Observable.fromEvent(views, 'click');\r\n//viewClick.subscribe({\r\n//  next() {\r\n//    //get actions\r\n//    console.log('view clicked');\r\n\r\n//  },\r\n//  error(e) { console.log(e) },\r\n//  complete() {\r\n//    //console.log('complete trigger click');\r\n//  }\r\n//});\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//SET EVENT HANDLER FOR EACH TRIGGER\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//var button = document.getElementById('button');\r\n//let clicks$ = Observable.fromEvent(button, 'click').map(e => e.pageX + 'px');\r\n////let clicks$ = Observable.fromEvent(button, 'click');//.map(e => '${e.pageX}px');\r\n\r\n//this sets event for each object; it's not just set once for the selector \r\n//need event actions to be optional\r\n//button click might do callfront before processing xhr\r\n//var bindings = document.querySelectorAll('.bind'); // All with attribute named \"property\"\r\n\r\n//MAKE the term called OBSERVED be trigger to reduce confusion between observed and observable\r\n//data-trigger are objects that trigger events; action based on json\r\n\r\n      /*\r\n       call \r\n       nav-class-logic function\r\n      class-state-function\r\n      if state is disabled: set attribute\r\n      Element.setAttribute(\"disabled\", \"\");\r\n\r\n      if state is not disabled: remove attribute\r\n      Element.removeAttribute(\"disabled\");\r\n       */\r\n\r\n      //get actions\r\n\r\n      /*\r\nevent listener will trigger this code\r\nloop over all views\r\nset all views to hidden \r\nset target view to visible\r\n        document.getElementById('view1').style.display = 'none';\r\n        document.getElementById('view2').style.display = 'block';\r\n\r\nhandle nav elements \r\nloop over all nav elements \r\nhandle nav elements individually or only within a container so multiple nav elements can be used\r\n\r\nfind container for nav clicked\r\nget all nav within container\r\nset class of clicked nav to active class\r\nhow to determine disabled, based on logic; takes priority over all other classes\r\nhow to determine visited, based on logic\r\nhow to determine enabled, based on logic\r\n\r\n\r\n\r\n{\r\n\t\"class-states\": [{\r\n\t\t\"active\": \"btn-spa-nav-active\"\r\n\t}, {\r\n\t\t\"enabled\": \"btn-spa-nav-enabled\"\r\n\t}, {\r\n\t\t\"visited\": \"btn-spa-nav-visited\"\r\n\t}, {\r\n\t\t\"disabled\": \"btn-spa-nav-disabled\"\r\n\t}]\r\n}'\r\n\r\n\r\n{\r\n\t\"class-states\": {\r\n\t\t\"active\": \"btn-spa-nav-active\",\r\n\t\t\"enabled\": \"btn-spa-nav-enabled\",\r\n\t\t\"visited\": \"btn-spa-nav-visited\",\r\n\t\t\"disabled\": \"btn-spa-nav-disabled\"\r\n\t}\r\n}\r\n\r\n*/\r\n}\r\n\r\n//THIS SETS ROUTE OBSERVABLES\r\nvar routecontainers = document.querySelectorAll('[data-routecontainer]');\r\n//console.log('routecontainers defined', typeof routecontainers, typeof routecontainers != \"undefined\");\r\n\r\nif (typeof routecontainers != \"undefined\") {\r\n  for (let routecontainer of routecontainers) {\r\n    //GET CLASS CLASS STATES\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //does this need to be inside the subscriber too\r\n    //let routecontainerjson = routecontainer.getAttribute('data-routecontainer');\r\n    //var routecontainerobj = JSON.parse(routecontainerjson);\r\n    //var statefunction = routecontainerobj.classstatefunction;\r\n    //var states = routecontainerobj.classstates;\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n    var routes = routecontainer.querySelectorAll('[data-route]'); // All with attribute named \"property\"\r\n    for (let route of routes) {\r\n      //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n      //this all needs to be in the subscribe\r\n      //var routeobj = route.getAttribute('data-route');\r\n      //var target = routeobj.target;\r\n      //configure event handler as click to target\r\n      //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n      //can initial class state be set here outside of the nav event click function\r\n\r\n      let routeClick = Observable.fromEvent(route, 'click');\r\n      routeClick.subscribe({\r\n        next() {\r\n          let routecontainerjson = routecontainer.getAttribute('data-routecontainer');\r\n          var routecontainerobj = JSON.parse(routecontainerjson);\r\n          //var statefunction = routecontainerobj.classstatefunction;container should observe data state to determine styles\r\n          var states = routecontainerobj.classstates;\r\n          //console.log('states', states);\r\n\r\n          /*\r\n          if \r\n            state is disabled, do nothing\r\n          else\r\n            navigate to view and update all nav styles\r\n\r\n          create function call option etc. for more sophisticated/custom routing logic\r\n\r\n          */\r\n          if (!route.hasAttribute('disabled')) {\r\n\r\n            var routeobj = JSON.parse(route.getAttribute('data-route'));\r\n            var targetobj = routeobj.target;\r\n            var fullcalendarobj = routeobj.fullcalendar;\r\n\r\n            console.log('routeobj', routeobj);\r\n            var target;\r\n            if (Array.isArray(targetobj)) {\r\n\r\n              for (let targetroute of targetobj) {\r\n                //console.log('targetroute', targetroute);\r\n                var _ds = targetroute.condition.datasource.replace(/-/g, \"_\");\r\n                var _df = targetroute.condition.datafield;\r\n                //console.log('_ds', _ds);\r\n                //console.log('_df', _df);\r\n                if (typeof (db.datasets[_ds].data[0][_df]) != 'undefined') {\r\n                  value = db.datasets[_ds].data[0][_df];\r\n                  if (targetroute.condition.value == value) {\r\n                    target = targetroute.name;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            } else {\r\n              target = targetobj;\r\n            }\r\n            //console.log('target', target);\r\n\r\n            //DISPLAY SELECTED VIEW; HIDE ALL OTHER VIEWS\r\n            var views = document.querySelectorAll('view');\r\n            for (let view of views) {\r\n              view.style.display = 'none';\r\n            }\r\n            var targetelement = document.getElementById(target);\r\n            targetelement.style.display = 'block';\r\n            //END DISPLAY SELECTED VIEW; HIDE ALL OTHER VIEWS\r\n            if (typeof fullcalendarobj != 'undefined') {\r\n              $('#fullcalendar').fullCalendar('render');\r\n            }\r\n\r\n            //if there is no class logic state function then just navigate to view selected\r\n\r\n            var activeelement = document.querySelector('.' + states.active);\r\n\r\n            if (activeelement != null) {\r\n              activeelement.classList.remove(states.active);\r\n              activeelement.classList.add(states.enabled);\r\n            }\r\n\r\n            route.classList.remove(states.enabled);\r\n            route.classList.add(states.active);\r\n\r\n\r\n            //var cb = window[routecontainerobj.classstatefunction];\r\n            //var cbparams = route;\r\n            //do we need to check that cb is function\r\n            //cb(cbparams).then(\r\n            //  function (response) {\r\n            //    //console.log('class states', states, states.active);\r\n\r\n            //    //only one nav btn can be active; all others must be something else\r\n            //    //event listener only processes one element at a time so\r\n            //    //need to set any active to something other than active\r\n            //    //the nav btns need to listen to other evnts on the page for data changes that will trigger a check on all nav elements\r\n\r\n            //    for (var state in states) {\r\n            //      //console.log('state', state, states[state]);\r\n            //      route.classList.remove(states[state]);\r\n            //      //if (states.hasOwnProperty(state)) {\r\n            //      //  user[k] = data[k];\r\n            //      //}\r\n            //    }\r\n            //    //console.log('response.class', response.class);\r\n\r\n            //    route.classList.add(response.class);\r\n\r\n            //    if (typeof response.disabled != 'undefined' || response.disabled != null) {\r\n            //      route.setAttribute(\"disabled\", \"\");\r\n            //    } else {\r\n            //      route.removeAttribute(\"disabled\");\r\n            //    }\r\n\r\n            //    //assuming xhr call callxhr(triggerobj);\r\n            //    //console.log(\"cb Success! \" , response);\r\n            //  },\r\n            //  function (error) { console.error(\"Failed!\"); }\r\n            //)\r\n\r\n\r\n          }\r\n\r\n        },\r\n        error(e) { console.log(e) },\r\n        complete() {\r\n          //console.log('complete trigger click');\r\n        }\r\n      });\r\n\r\n      //  for (let item of routeobj.classes) {\r\n      //how do we handle switching classes\r\n      //  }\r\n    }\r\n  }\r\n} else {\r\n  //process as individual nav routes located anywhere on the page layout rather than as a group\r\n}\r\n\r\n//triggers are things like: buttons, change input events\r\n//this is called; or should be called on page load when dom is ready\r\n//replicate this code when new component is added to dom\r\n//DRY; make function that can be called on page load and dynamically when needed\r\n\r\nvar triggers = document.querySelectorAll('[data-trigger]'); // All with attribute named \"property\"\r\nfor (let trigger of triggers) {\r\n  InitializeTrigger(trigger);\r\n}//end for triggers\r\n\r\nfunction InitializeTrigger(trigger) {\r\n  var autoreset = false;\r\n  let triggerjson = trigger.getAttribute('data-trigger');\r\n\r\n  //var thisName = (typeof trigger.name != 'undefined') ? trigger.name : (trigger.getAttribute('id') != null) ? trigger.getAttribute('id') : 'not set';\r\n  //console.log('triggerjson', thisName, triggerjson);\r\n\r\n  //var item = null;;\r\n  //try {\r\n  //  item = JSON.parse(triggerjson);\r\n  //} catch (e) {\r\n  //  console.log('Invalid json');\r\n  //  break;\r\n  //}\r\n\r\n  //let triggerobj = trigger.getAttribute('data-trigger');\r\n  //var types = obj.type;\r\n  //console.log('types', types)\r\n\r\n  //INITIALIZE DATASET AND DATA FIELD\r\n  var _ds = 'store';\r\n\r\n  //console.log('triggerjson', triggerjson);\r\n  var obj = JSON.parse(triggerjson);\r\n  //var triggerarr = triggersobj.triggers;\r\n  //console.log('obj', obj);\r\n  //console.log('triggersobj', triggerarr);\r\n  //for (let obj of triggerarr) {\r\n\r\n  var autoreset = 'false';\r\n\r\n  if (typeof obj.datasource !== 'undefined') {\r\n    _ds = obj.datasource;\r\n  }\r\n\r\n  //this initiates all event listeners; assigns events to specific elements\r\n  //for (let triggerevt of item) {\r\n  for (let item of obj.triggers) {\r\n    switch (item.type) {\r\n      case 'download':\r\n        break;\r\n      case 'api':\r\n        //check for callbefore and process xhr via function call; prepromise, postpromise\r\n        /*\r\n         we want event handler to trigger once this is clicked\r\n         slots can be added via crud action and then xhr action \r\n         should xhr happen first so we get successful response back\r\n\r\n        ah call slots needs to be done manually from fullcalendar render \r\n        this trigger is event handler that calls xhr but with element so json options can be passed and data attributes can be processed\r\n\r\n        calling xhr manually still needs to pass object \r\n        can element be differentiated from json object\r\n        call apiqueue; one for trigger and one for manual; each passes flag to indicate which type it is \r\n        the queue needs to accept an object with type in addition to calling object \r\n        apicaller needs to handle each type \r\n        dom element has data-trigger json and possibly attributes \r\n        manual call has json too, it could be the same format to make it easier with type = manual\r\n        can handle more tha just queries and can include query alias\r\n\r\n         */\r\n        let triggerApi = Observable.fromEvent(trigger, 'click');\r\n        triggerApi.subscribe({\r\n          next() {\r\n            var apiobject = {};\r\n            apiobject.type = 'event';\r\n            apiobject.object = this;\r\n            apicontrol.start(apiobject);\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete event---')\r\n          }\r\n        });\r\n\r\n        break;\r\n      case 'fullcalendar':\r\n        //custom trigger just for the full calendar library\r\n/*\r\n get json \r\n set calendar id \r\n set params via json \r\n set params via any data objects [cart]\r\n call refetch\r\n\r\n */\r\n\r\n        //var _thisServices = servicesArr.join(\",\");\r\n        //calendardata = {\r\n        //  locationguid: _locationguid,\r\n        //  staff: _thisStaff,\r\n        //  services: _thisServices,\r\n        //  calendarrequest: \"true\",\r\n        //  calendarfilter: \"public-availabilty-get\"\r\n        //};\r\n        //$('#fullcalendar').fullCalendar('refetchEvents');\r\n        let triggerFC = Observable.fromEvent(trigger, 'click');\r\n        triggerFC.subscribe({\r\n          next() {\r\n            //console.log('full calendar triggered');\r\n\r\n            var _thisId = item.calendarid;\r\n            var _thisParams = item.params;\r\n            var _thisDataObjects = item.dataobjects;\r\n\r\n            //if (typeof _rex.datasets[_thisDataset] == 'undefined') {\r\n            //  _rex.datasets[_thisDataset] = {}\r\n\r\n            //  function all() { return this.data }\r\n            //  _rex.datasets[_thisDataset].all = all;\r\n            //  _rex.datasets[_thisDataset].meta = { \"object\": \"false\" };\r\n            //  _rex.datasets[_thisDataset].data = {};\r\n            //}\r\n\r\n            var calendardata = {};\r\n\r\n            for (let data of _thisParams) {\r\n              Object.keys(data).forEach(key => {\r\n                //console.log(key, data[key]);\r\n                calendardata[key] = data[key];\r\n                //buildFormData(formData, data[key], parentKey ? `${parentKey}[${key}]` : key);\r\n              });\r\n            }\r\n\r\n            for (let _thisDataset of _thisDataObjects) {\r\n              //console.log('_thisDataset', _thisDataset);\r\n              //console.log('_rex.datasets[_thisDataset]', _rex.datasets[_thisDataset].data);\r\n              if (typeof _rex.datasets[_thisDataset] != 'undefined') {\r\n                //for (let data of _rex.datasets[_thisDataset].data) {\r\n                var data = _rex.datasets[_thisDataset].data;\r\n                  console.log('data', data);\r\n                  Object.keys(data).forEach(key => {\r\n                    //console.log(key, data[key]);\r\n                    //console.log('Array?', Array.isArray(data[key]));\r\n                    if (Array.isArray(data[key])) {\r\n                      var elements_array = data[key].join(\",\");\r\n                      calendardata[key] = elements_array;\r\n                    } else {\r\n                      calendardata[key] = data[key];//this would pass value as array if not \"joined\"\r\n                    }\r\n\r\n                    //buildFormData(formData, data[key], parentKey ? `${parentKey}[${key}]` : key);\r\n                  });\r\n                //}\r\n              }\r\n            }\r\n\r\n            console.log('calendardata', calendardata);\r\n            //need jquery and fullcalendar referenced\r\n            //$('#' + _thisId).fullCalendar('refetchEvents');\r\n            PopulateCalendar();\r\n            /*\r\n             to submit xhr; need parameter name [serviceguids]\r\n             to calculate template values; need datasource, fieldname/key value, \r\n             to save to object [cart]; is this array or singular value; list of service guids vs. booking date or singular staff guid\r\n             */\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete trigger click');\r\n          }\r\n        });\r\n\r\n        break;\r\n      case 'http':\r\n        break;\r\n      case 'route':\r\n        break;\r\n      case 'change':\r\n        //_df can not be null or what is this field for other than to manipulate data locally\r\n        //might need to use blur; change may not trigger unless enter is clicked; input is another option but might not work in all browsers\r\n        //var _df = (typeof trigger.name != 'undefined') ? trigger.name : (trigger.getAttribute('id') != null) ? trigger.getAttribute('id') : null;\r\n        //if (_df == null) {\r\n        //  console.log('Page error: name attribute is not set');\r\n        //  break;\r\n        //}\r\n        /*\r\n         blur only helps with text and text area; changes handles blur and changes for radio, checkbox, select, date, and file\r\n         blur, keyup and change (are there others) will update watching elements and populate datasets \r\n         keyup hydrates watchers directly without updating dataset \r\n         blur/change updates dataset and sets history of object to allow for undo\r\n         \r\n         */\r\n\r\n        //CHANGE SHOULD ONLY TRIGGER WHEN THE DATA HAS CHANGED\r\n\r\n\r\n        //console.log('PRE-INIT: WAS: ', _ds, _df, trigger.name);\r\n        let triggerChange = Observable.fromEvent(trigger, 'change');\r\n        triggerChange.subscribe({\r\n          next() {\r\n\r\n            //truncate history array from currect history pointer\r\n            //if (typeof(_rex.meta.pointer) ==='number') {\r\n            //if (!isNAN(_rex.meta.pointer)) {\r\n            var slice = 0;\r\n            if (Number.isInteger(_rex.meta.history.pointer) && _rex.meta.history.pointer + 1 < _rex.meta.history.data.length) {\r\n              slice = _rex.meta.history.data.length - (_rex.meta.history.pointer + 1);\r\n              //console.log('slice: ', slice, -slice);\r\n              _rex.meta.history.data = _rex.meta.history.data.slice(0, -slice);\r\n            }\r\n            var ptr = _rex.meta.history.data.length;\r\n            //console.log('WAS: ', _ds, trigger.name);\r\n            var was = db.datasets[_ds].data[0][trigger.name];\r\n            var historyitem = {\r\n              datasource: _ds,\r\n              datafield: trigger.name,\r\n              value: trigger.value,\r\n              was: was\r\n            }\r\n            _rex.meta.history.pointer = ptr;\r\n            _rex.meta.history.data.push(historyitem);\r\n            _rex.datasets[_ds].data[0][trigger.name] = trigger.value;\r\n            //include.js options are only: upper, lower, encrypt, clone, and sanitize numbers/characters/regex\r\n\r\n            //get all elements watching this trigger; should watch dataset/field\r\n            var elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds + '.' + 'datafield-' + classRnd + '-' + trigger.name); //trigger.name All with attribute named \"property\"\r\n            //populate dataset/store with value;\r\n            //_r.data[0][trigger.name] = trigger.value;\r\n            //populate watching elements with trigger value\r\n            //SO JUST UPDATE FIELD DIRECTLY\r\n\r\n            for (let element of elements) {\r\n              HydrateElement(element)\r\n              //observedvalue = db.datasets[_ds].data[0][trigger.name];\r\n              //observedvalue = trigger.value;\r\n            }\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete event---')\r\n          }\r\n        });\r\n\r\n\r\n        break;\r\n      case 'undo':\r\n        //need to handle first element\r\n        //move back in history if exists\r\n        //this is a click trigger\r\n        let triggerUndo = Observable.fromEvent(trigger, 'click');\r\n        triggerUndo.subscribe({\r\n          next() {\r\n            var _df;\r\n            //change pointer -1\r\n            //update data to 'was' value\r\n            var ptr = Number.isInteger(_rex.meta.history.pointer) ? (_rex.meta.history.pointer > 0) ? _rex.meta.history.pointer : 0 : null;\r\n\r\n            if (Number.isInteger(ptr)) {\r\n              _ds = _rex.meta.history.data[ptr].datasource;\r\n              _df = _rex.meta.history.data[ptr].datafield;\r\n              value = _rex.meta.history.data[ptr].was;\r\n              //_rex.meta.history.pointer = (ptr == 0) ? 0 : ptr - 1;\r\n              _rex.meta.history.pointer = ptr - 1;\r\n\r\n              //include.js options are only: upper, lower, encrypt, clone, and sanitize numbers/characters/regex\r\n\r\n              //get all elements watching this trigger; should watch dataset/field\r\n              var elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds + '.' + 'datafield-' + classRnd + '-' + _df); //trigger.name All with attribute named \"property\"\r\n              //populate dataset/store with value;\r\n              //console.log('undo', ptr, _ds, _df, value);\r\n              _rex.datasets[_ds].data[0][_df] = value;\r\n\r\n              //populate watching elements with history value\r\n              //SO JUST UPDATE FIELD DIRECTLY\r\n              for (let element of elements) {\r\n                HydrateElement(element)\r\n                //observedvalue = db.datasets[_ds].data[0][trigger.name];\r\n                //observedvalue = trigger.value;\r\n              }\r\n\r\n              //SHOULD ALL INPUTS BE UPDATED BEFORE AND WATCHING ELEMENTS\r\n              //need to also update any input fields (likely only one) to the value reset from history\r\n              var inputs = document.querySelector('[name=' + _df + ']');\r\n              if (typeof (inputs.length) != 'undefined') {\r\n                for (let input of inputs) {\r\n                  let inputjson = input.getAttribute('data-trigger');\r\n                  var inputds = 'store';\r\n                  for (let inputobj of JSON.parse(inputjson)) {\r\n                    if (typeof inputobj.datasource !== 'undefined') {\r\n                      inputds = inputobj.datasource;\r\n                    }\r\n                  }//end check all datasources\r\n                  if (inputds == _ds) {\r\n                    //match; update value\r\n                    input.value = value;\r\n                    //make sure this does not trigger another event followed by foit\r\n                  }\r\n                }//end check all inputs\r\n\r\n              } else {\r\n                let input = inputs;\r\n                let inputjson = input.getAttribute('data-trigger');\r\n                var inputds = 'store';\r\n                var inputobj = JSON.parse(inputjson);\r\n                if (typeof inputobj.datasource !== 'undefined') {\r\n                  inputds = inputobj.datasource;\r\n                }\r\n                if (inputds == _ds) {\r\n                  input.value = value;\r\n                  //make sure this does not trigger another event followed by foit\r\n                }\r\n\r\n              }\r\n            }\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete event---')\r\n          }\r\n        });\r\n\r\n        break;\r\n      case 'redo':\r\n        //move forward in history if exists\r\n        let triggerRedo = Observable.fromEvent(trigger, 'click');\r\n        triggerRedo.subscribe({\r\n          next() {\r\n            var _df;\r\n            var ptr = Number.isInteger(_rex.meta.history.pointer) ? (_rex.meta.history.pointer < _rex.meta.history.data.length - 2) ? _rex.meta.history.pointer + 1 : _rex.meta.history.data.length - 1 : null;\r\n\r\n            if (Number.isInteger(ptr)) {\r\n              _ds = _rex.meta.history.data[ptr].datasource;\r\n              _df = _rex.meta.history.data[ptr].datafield;\r\n              value = _rex.meta.history.data[ptr].value;\r\n              _rex.meta.history.pointer = (ptr == _rex.meta.history.length) ? _rex.meta.history.length - 1 : ptr;\r\n\r\n              var elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds + '.' + 'datafield-' + classRnd + '-' + _df); //trigger.name All with attribute named \"property\"\r\n              _rex.datasets[_ds].data[0][_df] = value;\r\n\r\n              for (let element of elements) {\r\n                HydrateElement(element)\r\n              }\r\n\r\n              var inputs = document.querySelector('[name=' + _df + ']');\r\n              if (typeof (inputs.length) != 'undefined') {\r\n                for (let input of inputs) {\r\n                  let inputjson = input.getAttribute('data-trigger');\r\n                  var inputds = 'store';\r\n                  for (let inputobj of JSON.parse(inputjson)) {\r\n                    if (typeof inputobj.datasource !== 'undefined') {\r\n                      inputds = inputobj.datasource;\r\n                    }\r\n                  }//end check all datasources\r\n                  if (inputds == _ds) {\r\n                    input.value = value;\r\n                  }\r\n                }//end check all inputs\r\n\r\n              } else {\r\n                let input = inputs;\r\n                let inputjson = input.getAttribute('data-trigger');\r\n                var inputds = 'store';\r\n                var inputobj = JSON.parse(inputjson);\r\n                if (typeof inputobj.datasource !== 'undefined') {\r\n                  inputds = inputobj.datasource;\r\n                }\r\n                if (inputds == _ds) {\r\n                  input.value = value;\r\n                }\r\n              }\r\n            }\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete event---')\r\n          }\r\n        });\r\n        break;\r\n      case 'keyup':\r\n        //only add event listener if keyup is set\r\n        let triggerKeyup = Observable.fromEvent(trigger, 'keyup');\r\n        triggerKeyup.subscribe({\r\n          next() {\r\n            //get all elements watching this trigger; should watch dataset/field\r\n            var elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds + '.' + 'datafield-' + classRnd + '-' + trigger.name); // All with attribute named \"property\"\r\n            //populate dataset/store with value;\r\n            //_r[trigger.name] = trigger.value;//should this be .data\r\n            //populate watching elements with trigger value\r\n            //NEED TO HYDRATE BASED ON THIS ELEMENT RATHER THAN WHAT IS IN DATASET BECAUSE THIS IS A TEMPORARY VALUE UNTIL CHANGE/BLUR IS TRIGGERED\r\n            //SO JUST UPDATE FIELD DIRECTLY\r\n\r\n            //todo; works\r\n            for (let element of elements) {\r\n              if (typeof item.autoreset !== 'undefined') {\r\n                autoreset = item.autoreset;\r\n              }\r\n\r\n              var observedvalue = '';\r\n              if (autoreset == 'true' && trigger.value == '') {\r\n                //get original value before keypress started; let this be configurable\r\n                //auto-reset:'true/false'\r\n                observedvalue = db.datasets[_ds].data[0][trigger.name];\r\n              } else {\r\n                observedvalue = trigger.value;\r\n              }\r\n\r\n              if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea') {\r\n                element.value = observedvalue;\r\n              } else {\r\n                element.innerHTML = observedvalue;\r\n              }\r\n\r\n            }\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete event---');\r\n          }\r\n        });\r\n        break;\r\n      case 'click':\r\n        //add xhr or redirect or reload page calls to send data to server\r\n\r\n        //add history function somewhere around here\r\n        let triggerClick = Observable.fromEvent(trigger, 'click');\r\n        triggerClick.subscribe({\r\n          next() {\r\n            //get actions\r\n            var cb = window[triggerobj.callbefore.function];\r\n            var cbparams = triggerobj.callbefore.params;\r\n\r\n            //do we need to check that cb is function\r\n            cb(cbparams).then(\r\n              function (response) {\r\n                //assuming xhr call callxhr(triggerobj);\r\n                console.log(\"cb Success! \" + response\r\n                );\r\n              },\r\n              function (error) { console.error(\"Failed!\"); }\r\n            )\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete trigger click');\r\n          }\r\n        });\r\n        break;\r\n      case 'crud':\r\n        //console.log('wiring up crud');\r\n        //the value crud is used as the trigger type\r\n        //when a crud element is clicked it triggers a data change somewhere\r\n        //could be: create, update, delete; can't see a reason to trigger on read so technically cud\r\n\r\n        //nav container needs classes added for each datasource watched; just like other observers\r\n        //process nav containers watching any datasources changed\r\n\r\n        //add history function somewhere around here\r\n        let triggerCRUD = Observable.fromEvent(trigger, 'click');\r\n        triggerCRUD.subscribe({\r\n          next() {\r\n\r\n            var _thisDataset = item.targetobject;\r\n            var _thisDataType = item.datatype;\r\n            var _thisParameterLabel = item.paramname;\r\n            if (typeof _rex.datasets[_thisDataset] == 'undefined') {\r\n              _rex.datasets[_thisDataset] = {}\r\n\r\n              function all() { return this.data }\r\n              _rex.datasets[_thisDataset].all = all;\r\n              _rex.datasets[_thisDataset].meta = { \"object\": \"false\" };\r\n              _rex.datasets[_thisDataset].data = {};\r\n            }\r\n\r\n            /*\r\n             to submit xhr; need parameter name [serviceguids]\r\n             to calculate template values; need datasource, fieldname/key value, \r\n             to save to object [cart]; is this array or singular value; list of service guids vs. booking date or singular staff guid\r\n             */\r\n\r\n            //\r\n            /*\r\n             what about \r\n             staff (single)\r\n             booking date (single) what about reserving time for a few minutes\r\n             comments (single) but updatable\r\n             notification preferences (single) but updatable\r\n             */\r\n            let key = trigger.getAttribute('data-key');\r\n            switch (_thisDataType) {\r\n              case 'toggle':\r\n                //if exists, remove\r\n                var iconelement = trigger.querySelector('#' + item.targeticon);\r\n                var classFrom = (iconelement.classList.contains(item.classshow)) ? item.classshow : item.classhide;\r\n                var classTo = (classFrom == item.classshow) ? item.classhide : item.classshow;\r\n                iconelement.classList.replace(classFrom, classTo);\r\n\r\n                var classFrom = (trigger.classList.contains(item.classactive)) ? item.classactive : item.classinert;\r\n                var classTo = (classFrom == item.classactive) ? item.classinert : item.classactive;\r\n                trigger.classList.replace(classFrom, classTo);\r\n\r\n                //console.log('_rex.datasets[_thisDataset].data', _rex.datasets[_thisDataset].data);\r\n                //console.log('_rex.datasets[_thisDataset].data', _rex.datasets[_thisDataset].data[0]);\r\n                //console.log('key', key);\r\n                //console.log('filtered', _rex.datasets[_thisDataset].data.length);\r\n                if (typeof _rex.datasets[_thisDataset].data[_thisParameterLabel] != 'undefined' && _rex.datasets[_thisDataset].data[_thisParameterLabel].length > 0) {\r\n                  //console.log('_rex.datasets[_thisDataset].data[0][_thisParameterLabel]', _rex.datasets[_thisDataset].data[0][_thisParameterLabel]);\r\n                  var filtered = grep(_rex.datasets[_thisDataset].data[_thisParameterLabel], key, 'unique');\r\n                  //console.log('filtered', filtered);\r\n                  _rex.datasets[_thisDataset].data[_thisParameterLabel] = filtered;//.push(key);\r\n                } else {\r\n                  //var row = {};\r\n                  //row[_thisParameterLabel] = [];\r\n                  //row[_thisParameterLabel].push(key);\r\n                  //console.log('row', row);\r\n                  _rex.datasets[_thisDataset].data[_thisParameterLabel] = [];\r\n                  _rex.datasets[_thisDataset].data[_thisParameterLabel].push(key) ;//.push(key);\r\n                  //console.log('object', _rex.datasets[_thisDataset].data);\r\n                  //console.log('stringify', JSON.stringify(_rex.datasets[_thisDataset].data));\r\n                }\r\n                break\r\n              case 'insert':\r\n                //always insert, like multiple products\r\n                _rex.datasets[_thisDataset].data[_thisParameterLabel].push(key);\r\n                break\r\n              case 'remove':\r\n                var filtered = grep(_rex.datasets[_thisDataset].data[_thisParameterLabel], key, 'remove');\r\n                _rex.datasets[_thisDataset].data[_thisParameterLabel].push(key);\r\n                break\r\n              case 'single':\r\n                //clear array and add this\r\n                var iconelement = trigger.querySelector('.' + item.targeticon);\r\n                console.log('item', item);\r\n\r\n\r\n\r\n                var classFrom = (iconelement.classList.contains(item.classshow)) ? item.classshow : item.classhide;\r\n                var classTo = (classFrom == item.classshow) ? item.classhide : item.classshow;\r\n                //hide checkmark for all elements\r\n                var elements = document.querySelectorAll('.' + item.targeticon);\r\n                for (let element of elements) {\r\n                  element.classList.replace(item.classshow, item.classhide);\r\n                }\r\n                iconelement.classList.replace(classFrom, classTo);\r\n\r\n                //var classFrom = (trigger.classList.contains(item.classactive)) ? item.classactive : item.classinert;\r\n                //var classTo = (classFrom == item.classactive) ? item.classinert : item.classactive;\r\n                //trigger.classList.replace(classFrom, classTo);\r\n\r\n                _rex.datasets[_thisDataset].data[_thisParameterLabel] = [];\r\n                _rex.datasets[_thisDataset].data[_thisParameterLabel].push(key);\r\n                console.log('_rex.datasets[_thisDataset].data', _rex.datasets[_thisDataset].data);\r\n                break\r\n              default:\r\n            }\r\n\r\n            /*\r\n            INSERT/UPDATE CART DATASET THINKS\r\n            get trigger key: serviceguid\r\n            get target object: cart\r\n            add to cart: \r\n              label (param name).(Array)[key, type, ]\r\n              serviceguids:[\"F99EDDEB-5C81-4A86-A505-730C2499404F\",\"1BEB4745-8A7D-43B9-9D42-7497CBD3C5C4\"]\r\n              productguids:[\"3A8E6407-82BB-4536-92C0-38A0BD0AD997\",\"F604DB43-2308-4824-92C2-044FBD1EAE43\"]\r\n              staff:[\"1A624C69-FA15-4010-9FAB-2E7657899BAB\"]\r\n              booking:{\"date\":\"\", \"time\":\"\", \"more\":\"any other details\"}\r\n\r\n              THIS IS IN THE XHR TRIGGER\r\n              confirm button submits forms and objects (cart) \r\n              params sent to server include labeled arrays:\r\n                serviceguids, productguids, staff\r\n              and object items\r\n                date, time, more; and their values\r\n\r\n            var target = item.targetobject;\r\n\r\n             */\r\n\r\n            //get all elements watching this trigger; should watch dataset/field\r\n            //console.log('crud triggered; call all elements watching these datasets');\r\n            //console.log('.' + 'dataset-' + classRnd + '-' + _thisDataset);\r\n            var elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _thisDataset); //trigger.name All with attribute named \"property\"\r\n            for (let element of elements) {\r\n              //console.log('element', element);\r\n              HydrateElement(element);\r\n            }\r\n\r\n\r\n            /*\r\n\r\n            HYDRATE CART COMPONENT THINKS\r\n             add to HydrateElement\r\n             update hydrate to handle complex object like a component/reset component since change was made and\r\n             update individual items; datetime\r\n             update arrays; products\r\n             either update entire component (which would be like updating a single inner html h2 tag)\r\n             or find a way to surgically update only the data that has changed either by dataset or knowing if a specific datum has changed\r\n             //handle sorting by: alpha, price, chron, etc.\r\n             */\r\n\r\n            //GENERIC THOUGHTS\r\n            //get actions\r\n            //var cb = window[triggerobj.function];\r\n\r\n            ////do we need to check that cb is function\r\n            //cb(elements).then(\r\n            //  function (response) {\r\n            //    //assuming xhr call callxhr(triggerobj);\r\n            //    console.log(\"cb Success! \" + response\r\n            //    );\r\n            //  },\r\n            //  function (error) { console.error(\"Failed!\"); }\r\n            //)\r\n\r\n          },\r\n          error(e) { console.log(e) },\r\n          complete() {\r\n            //console.log('complete trigger click');\r\n          }\r\n        });\r\n        break;\r\n    }//end for type\r\n  }\r\n  //}\r\n\r\n  //only subscribe to desired events\r\n\r\n\r\n\r\n  /*\r\n   if click, get elements to process click\r\n\r\nfor click; check for callbefore\r\nset cb to callbefore value\r\n    cb(parameters).then(\r\n      function (value) { console.log('/* code if successful continue ************************************************************ ') },\r\n      function (error) { console.log('/* code if error ************************************************************ ') }\r\n    );\r\n\r\nnext(){\r\n    somePromise_that_always_succeeds()\r\n    .then(function (result) {\r\n      return callbefore(result);\r\n    })\r\n    .then(function (newResult) {\r\n      return do_what_we_really_want_to_do_like_xhr(newResult);\r\n    })\r\n\r\n\r\n   */\r\n\r\n  //THIS WAS TEST TO SET ALL ELEMENTS TO HAVE KEYUP TRIGGER; USED CLASS bind\r\n  //let triggerKeyup = Observable.fromEvent(trigger, 'keyup');\r\n  //triggerKeyup.subscribe({\r\n  //  next() {\r\n  //    //get all elements watching this trigger; should watch dataset/field\r\n  //    var elements = document.querySelectorAll('.' + trigger.name); // All with attribute named \"property\"\r\n  //    //populate dataset/store with value;\r\n  //    _r[trigger.name] = trigger.value;\r\n  //    //populate watching elements with trigger value\r\n  //    for (let element of elements) {\r\n  //      HydrateElement(element)\r\n  //    }\r\n  //  },\r\n  //  error(e) { console.log(e) },\r\n  //  complete() { console.log('complete event---') }\r\n  //});\r\n\r\n  //THIS WAS TEST TO SET ALL ELEMENTS TO HAVE BLUR TRIGGER\r\n  //let triggerBlur = Observable.fromEvent(trigger, 'blur');\r\n  //triggerBlur.subscribe({\r\n  //  next() {\r\n  //    var elements = document.querySelectorAll('.' + trigger.name); // All with attribute named \"property\"\r\n  //    _r[trigger.name] = trigger.value;\r\n  //    /*\r\n  //     blurred item should be stored and set in history\r\n  //     need function to undo and reset\r\n  //      */\r\n  //    for (let element of elements) {\r\n  //      HydrateElement(element)\r\n  //    }\r\n  //  },\r\n  //  error(e) { console.log(e) },\r\n  //  complete() {\r\n  //    //console.log('complete event...');\r\n  //  }\r\n  //});\r\n\r\n}\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\n\r\nvar grep = function (items, value, action) {\r\n  //console.log('items, value, action', items, value, action)\r\n\r\n  var filtered = []\r\n    //len = items.length,\r\n  switch (action) {\r\n    case 'exists':\r\n      for (let item of items) {\r\n        if (item == value) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n      break;\r\n    case 'remove':\r\n      for (let item of items) {\r\n        if (item != value) {\r\n          filtered.push(item);\r\n        }\r\n      }\r\n      return filtered;\r\n      break;\r\n    case 'unique':\r\n      var found = false;\r\n      for (let item of items) {\r\n        if (item != value) {\r\n          filtered.push(item);\r\n        } else {\r\n          found = true;\r\n        }\r\n      }\r\n      if (!found) {\r\n        filtered.push(value);\r\n      }\r\n      return filtered;\r\n      break;\r\n  }\r\n}\r\n\r\nfunction padMax(str, max, padstr) {\r\n  str = str.toString();\r\n  return str.length < max ? pad(padstr + str, max) : str;\r\n}\r\nfunction padAppend(str, padlen, padstr) {\r\n  return str.padStart(str.length + padlen, padstr);\r\n}\r\n\r\n//this populates all elements watching/observing trigger elements\r\n//so trigger element might populate specific data field; populate all elements watching that field\r\n//store might be different datasource\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//TODO USE INCLUDE 3109 TO GET INPUT POPULATION CODE\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//hydrate is called from triggers if element is \"observing\" trigger; if observer is watching dataset-...-datasetlabel\r\nfunction HydrateElement(element) {\r\n  //console.log('');\r\n  //console.log('element', element, '==============================================================');\r\n  let observe = element.getAttribute('data-observe');\r\n  var value = '';\r\n  var _ds = 'store';\r\n  var _df = '';\r\n\r\n  //assuming multiple things can be done on item; perhaps populate then clone then set to uppercase\r\n  for (let item of JSON.parse(observe)) {\r\n    //console.log('OBSERVE OBJECT', item);\r\n    //var item = JSON.parse(observe)[0];\r\n\r\n    if (typeof item.datasource !== 'undefined') {\r\n      //console.log('item.datasource', item);\r\n      //console.log('item.datasource', item.datasource);\r\n      if (Array.isArray(item.datasource)) {\r\n        _ds = item.datasource;\r\n      } else {\r\n        _ds = item.datasource.replace(/-/g, \"_\");\r\n      }\r\n    }\r\n    if (typeof item.value !== 'undefined') {\r\n      _df = item.value;\r\n    }\r\n\r\n    //if dataset for element binding does not exist; perhaps not yet loaded; return/break/\r\n    //console.log('db.datasets[_ds]', _rex.datasets[_ds])\r\n    //if (db.datasets[_ds] != null) {\r\n\r\n    //}\r\n\r\n    //if (init && _ds != '' && _df != '') {\r\n    //  element.classList.add('dataset-' + classRnd + '-' + _ds);\r\n    //  element.classList.add('datafield-' + classRnd + '-' + _df);\r\n    //  init = false;\r\n    //}\r\n\r\n    //console.log('item', item);\r\n    //console.log('item.action', Array.isArray(item.action));\r\n\r\n    switch (item.type) {\r\n      case 'nav':\r\n        var navelements = element.querySelectorAll('[data-route]'); //trigger.name All with attribute named \"property\"\r\n        for (let navelement of navelements) {\r\n          let thisroute = navelement.getAttribute('data-route');\r\n          //console.log('thisroute', thisroute);\r\n          var thisobj = {};//what if template JSON HAS MORE THAN ONE object\r\n          try {\r\n            thisobj = JSON.parse(thisroute);//what if template JSON HAS MORE THAN ONE object\r\n          } catch (e) {\r\n            console.log('Invalid JSON');\r\n          }\r\n          //console.log('thisobj', thisobj);\r\n\r\n          if (typeof thisobj.state != 'undefined' && typeof thisobj.state.function != 'undefined') {\r\n            var p = window[thisobj.state.function];\r\n            p().then(\r\n              function (response) {\r\n                //assuming xhr call callxhr(triggerobj);\r\n                //console.log(response);\r\n              },\r\n              function (error) { console.error(\"Failed!\", error); }\r\n            )\r\n          }\r\n\r\n          if (typeof thisobj.state != 'undefined' && typeof thisobj.state.condition != 'undefined') {\r\n            //use NodeIterator.previousNode() to find container and the classes for enabled and disabled\r\n            var _classenabled = thisobj.state.classenabled;\r\n            var _classdisabled = thisobj.state.classdisabled;\r\n            for (let condition of thisobj.state.condition) {\r\n              var _ds = condition.datasource;\r\n              var _df = condition.datafield;\r\n              //console.log('db.datasets[_ds].data', _rex.datasets[_ds].data);\r\n              //console.log('db.datasets[_ds].data[0]', _rex.datasets[_ds].data[0]);\r\n              //console.log('typeof db.datasets[_ds].data[0][_df]', typeof db.datasets[_ds].data[0][_df], typeof db.datasets[_ds].data[0][_df]);\r\n              if (typeof db.datasets[_ds].data[_df] != 'undefined' && typeof db.datasets[_ds].data[_df] == 'object') {\r\n                //console.log('condition.operator', condition.operator);\r\n                switch (condition.operator) {\r\n                  case '=':\r\n                    //when true && if doing a numerical comparison; call numerical state function\r\n                    if (db.datasets[_ds].data[_df].length == Number(condition.count)) {\r\n                      //console.log('going in =');\r\n                      SetNavState(navelement, thisobj, condition);\r\n                    }\r\n                    break\r\n                  case '>':\r\n                    //console.log('going in >');\r\n                    //when true && if doing a numerical comparison; call numerical state function\r\n                    if (db.datasets[_ds].data[_df].length > Number(condition.count)) {\r\n                      //console.log('SetNavState(navelement)', navelement);\r\n                      //console.log('thisobj)', thisobj );\r\n                      //console.log('condition)', condition);\r\n                      SetNavState(navelement, thisobj, condition);\r\n                    }\r\n                    break\r\n                  default:\r\n                }\r\n              } else {\r\n                navelement.setAttribute('disabled', '');\r\n                navelement.classList.remove(_classenabled);\r\n                navelement.classList.add(_classdisabled);\r\n              }\r\n\r\n            }\r\n          }\r\n        }\r\n        break;\r\n      case 'html':\r\n        //if array just use first element for now\r\n        //should all datasets be set to array to work consistently?\r\n        //set meta value object to true or false\r\n        value = db.datasets[_ds].data[0][item.value];\r\n        //if (db.datasets[_store].data.length > 1) {\r\n        //  value = db.datasets[_store].data[0][item.value];\r\n        //} else {\r\n        //  value = db.datasets[_store].data[item.value];\r\n        //}\r\n\r\n        break;\r\n      case 'this':\r\n        //do what; actions\r\n        //if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea') {\r\n        //  value = element.value;\r\n        //} else {\r\n        //  value = element.innerHTML;\r\n        //}\r\n        //console.log('value', value);\r\n        //console.log('item.action', Array.isArray(item.action));\r\n        if (!Array.isArray(item.action)) {\r\n          item.action = [item.action];\r\n        }\r\n        for (let action of item.action) {\r\n          switch (action.toLowerCase()) {\r\n            case 'sanitize':\r\n              value = SanitizeNumber(value);\r\n              break;\r\n            case 'upper':\r\n              value = value.toUpperCase();\r\n              break;\r\n            case 'lower':\r\n              value = value.toLowerCase();\r\n              break;\r\n          }\r\n        }\r\n\r\n        //innerhtml only works for non input elements; need test\r\n        //if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea') {\r\n        //  element.value = value;\r\n        //} else {\r\n        //  element.innerHTML = value;\r\n        //}\r\n\r\n        break;\r\n      case 'clone':\r\n        //value is name of new element\r\n        var elementvalue = element.value;\r\n        var value = item.value;\r\n        //if any actions\r\n        if (typeof (item.action) != 'undefined' && item.action != null) {\r\n          elementvalue = Transform(element.value, item.action);\r\n        } \r\n        var clone = document.getElementById(value);\r\n\r\n        //If it isn't \"undefined\" and it isn't \"null\", then it exists.\r\n        if (typeof (clone) != 'undefined' && clone != null) {\r\n          clone.value = elementvalue;\r\n        } else {\r\n          const node = document.createElement('input');\r\n          //make hidden; set id, set value\r\n          const elId = document.createAttribute(\"id\");\r\n          elId.value = value;\r\n          const elName = document.createAttribute(\"name\");\r\n          elName.value = value;\r\n          const elValue = document.createAttribute(\"value\");\r\n          elValue.value = elementvalue;\r\n          node.setAttributeNode(elId);\r\n          node.setAttributeNode(elName);\r\n          node.setAttributeNode(elValue);\r\n          element.appendChild(node);\r\n        }\r\n        break;\r\n      case 'template':\r\n        //HYDRATING TEMPLATE BASED ON CONTAINER\r\n        //console.log('HYDRATING TEMPLATE BASED ON CONTAINER');\r\n        /*\r\n         add options for groups; filter, separate template\r\n        */\r\n\r\n        //assume the template container needs to start empty; does not seem to affect list of initial items i.e. services\r\n        //cart is updated every time cart is modified; don't want to add more than one cart template\r\n        //may need option to \"clear\" if multiple template are needed\r\n        element.innerHTML = '';\r\n\r\n        var _target = (typeof item.target == 'undefined') ? 'dom' : item.target;//default to light dom\r\n        var _templatename = item.name;\r\n        //console.log(_target, _ds, _templatename);\r\n        //_ds = item.datasource;\r\n\r\n        var targetnode = element;\r\n        if (_target === 'shadow') {\r\n          targetnode = element.attachShadow({ mode: 'open' });\r\n        }\r\n\r\n        //loop over every record in dataset\r\n        //console.log('');\r\n        //console.log('_templatename', _templatename);\r\n        //console.log(_rex.datasets[_ds]);\r\n        const templatecss = document.getElementById(_templatename + '-css');\r\n        if (templatecss != null) {\r\n          var templateContentCss = templatecss.content.cloneNode(true);\r\n          targetnode.appendChild(templateContentCss);\r\n        }\r\n\r\n        //console.log('ITEM OBJECT', item);\r\n        //console.log('_rex.datasets[_ds].data', _ds, _rex.datasets[_ds].data);\r\n        //SET TO ARRAY IF OBJECT SO LOGIC REMAINS CONSISTENT\r\n        var templateArray = (Array.isArray(_rex.datasets[_ds].data)) ? _rex.datasets[_ds].data : [_rex.datasets[_ds].data];\r\n        for (let row of templateArray) {\r\n          //console.log('');\r\n          //console.log('DATASET ROW ---', row);\r\n          const template = document.getElementById(_templatename);\r\n          let templateContent = document.createElement('div');\r\n          templateContent.append(template.content.cloneNode(true));\r\n\r\n          let attrClone;\r\n          let attributes = Array.prototype.slice.call(template.attributes);\r\n          while (attrClone = attributes.pop()) {\r\n            if (attrClone.nodeName.toLocaleLowerCase() != 'id') {\r\n            templateContent.setAttribute(attrClone.nodeName, attrClone.nodeValue);\r\n            }\r\n          }\r\n          //console.log('templateContent', templateContent);\r\n\r\n          var templateelements = templateContent.querySelectorAll('[data-observe]');\r\n          targetnode.appendChild(templateContent);\r\n\r\n\r\n          //var attr = document.createAttribute(thisobj.name);\r\n          //var attrValue = row[thisobj.value];\r\n          //attr.value = attrValue ;\r\n          //templateelement.setAttributeNode(attr);\r\n\r\n          //console.log('template', template);\r\n          //console.log('templateContent', templateContent);\r\n          //console.log('templateContent', templateContent.firstChild);\r\n          //console.log('item.key', item.key);\r\n\r\n          if (typeof item.key != 'undefined') {\r\n            var attrKey = document.createAttribute('data-key');\r\n            //var attrKey = document.createAttribute('data-' + item.key);\r\n            attrKey.value = row[item.key];\r\n            templateContent.setAttributeNode(attrKey);\r\n          }\r\n\r\n          //console.log('thisobj data observe json', thisobj);\r\n          //console.log('thisobj KEY', item.key, row[item.key]);\r\n\r\n          //populate each element inside template\r\n          for (let templateelement of templateelements) {\r\n            var _dselement = 'store';\r\n            var _dfelement = '';\r\n\r\n            let thisobserve = templateelement.getAttribute('data-observe');\r\n            var thisobj = JSON.parse(thisobserve)[0];//what if template JSON HAS MORE THAN ONE object\r\n            //console.log(\"templateelement \", templateelement);\r\n            //console.log(\"thisobj \", thisobj);\r\n\r\n            /*\r\n             if there is a key in the container data-observe json for the template; auto include it as an attribute at the template root\r\n             */\r\n            //console.log('thisobj data observe json', item);\r\n            //console.log('thisobj data observe json', thisobj);\r\n            //console.log('thisobj KEY', item.key);\r\n            //console.log('template key?', templateContent);\r\n\r\n\r\n            //console.log(thisobj);\r\n            if (typeof thisobj.datasource !== 'undefined') {//can this be moved outside for loop\r\n              _ds = thisobj.datasource;\r\n            }\r\n            if (typeof thisobj.value !== 'undefined') {\r\n              _df = thisobj.value;\r\n            }\r\n\r\n            if (typeof thisobj.datasource !== 'undefined') {\r\n              _dselement = thisobj.datasource;\r\n            }\r\n\r\n            //console.log('thisobj.type', thisobj.type);\r\n            switch (thisobj.type) {\r\n              case 'html':\r\n                var thisfield = thisobj.value;\r\n                //console.log(thisfield);\r\n                //console.log(_dselement, thisfield);\r\n                //console.log(db.datasets[_dselement].data);\r\n                var itemValue = '';\r\n                var itemPrepend = (thisobj.prepend != null) ? thisobj.prepend : '';\r\n                var itemValue = row[thisobj.value];\r\n                var itemAppend = (thisobj.append != null) ? thisobj.append : '';\r\n                var itemPrependPad = (thisobj.prependpad != null) ? thisobj.prependpad : '';\r\n                var itemAppendPad = (thisobj.appendpad != null) ? thisobj.appendpad : '';\r\n\r\n                if (db.datasets[_dselement].length > 1) {\r\n                  itemValue = row[thisfield];\r\n                  //templateelement.innerHTML = row[thisfield];\r\n                } else {\r\n                  itemValue = row[thisfield];\r\n                  //templateelement.innerHTML = row[thisfield] + ' ---';\r\n                }\r\n                templateelement.innerHTML = itemPrepend + itemPrependPad + itemValue + itemAppendPad + itemAppend;\r\n                //item.classList.add(obj.value);\r\n                break;\r\n              case 'attr':\r\n                /*\r\n                 need conditional like \r\n                 if value = something then use defualt\r\n                 if no photo use /assets/img/profile_photos/photo-profile-sm.png\r\n                 conditional\r\n\r\n                 if (row.hasphoto == '1') {\r\n                var conditionalOperand = row.conditional[thisobj.value];\r\n                var conditionalOperator = //row.conditional[thisobj.value];\r\n                var conditionalResult\r\n                Operand and Parameter are similar; operand is input to a function\r\n\r\n\r\n                 */\r\n                //if {} then populate dynamically\r\n                //console.log('ATTRIBUTE: ', row, thisobj);\r\n                var attr = document.createAttribute(thisobj.name);\r\n                var attrPrepend = (thisobj.prepend != null) ? thisobj.prepend : '';\r\n                var attrValue = row[thisobj.value];\r\n                var attrAppend = (thisobj.append != null) ? thisobj.append : '';\r\n                var attrPrependPad = (thisobj.prependpad != null) ? thisobj.prependpad : '';\r\n                var attrAppendPad = (thisobj.appendpad != null) ? thisobj.appendpad : '';\r\n                var attrbustcache = (thisobj.bustcache != null && thisobj.bustcache == 'true') ? Date.now() : '';\r\n\r\n                attr.value = attrPrepend + attrPrependPad + attrValue + attrAppendPad + attrAppend + attrbustcache;\r\n                templateelement.setAttributeNode(attr);\r\n                break;\r\n              case 'function':\r\n\r\n                //console.log(\"function \", thisobj.value, thisobj);\r\n                var p = window[thisobj.value];\r\n                var params = row;//thisobj.params;\r\n\r\n                //do we need to check that cb is function\r\n                p(params).then(\r\n                  function (response) {\r\n                    //assuming xhr call callxhr(triggerobj);\r\n                    templateelement.innerHTML = response;\r\n                  },\r\n                  function (error) { console.error(\"Failed!\"); }\r\n                )\r\n\r\n\r\n                //templateelement.innerHTML = \"calling\";\r\n                break;\r\n            }\r\n          }\r\n\r\n\r\n          //append template for each record in dataset\r\n          //console.log(templateContent);\r\n          targetnode.appendChild(templateContent);\r\n          //const para = document.createElement('p');\r\n          //para.innerHTML = 'Hi';\r\n          //targetnode.appendChild(para);\r\n        }\r\n\r\n        /*\r\n         now that template has been appended to dom\r\n         enable event handlers\r\n\r\n\r\n\r\n         */\r\n        var triggers = element.querySelectorAll('[data-trigger]'); // All with attribute named \"property\"\r\n        //console.log('element', triggers.length, element)\r\n        for (let trigger of triggers) {\r\n          InitializeTrigger(trigger);\r\n        }//end for triggers\r\n\r\n\r\n        break;\r\n      case 'attr':\r\n        //if {} then populate dynamically\r\n        console.log('ATTRIBUTE: ', item);\r\n        var attr = document.createAttribute(item.name);\r\n        var attrPrepend = (item.prepend != null) ? item.prepend : '';\r\n        var attrValue = db.datasets.store[item.value];\r\n        var attrAppend = (item.append != null) ? item.append : '';\r\n        var attrPrependPad = (item.prependpad != null) ? item.prependpad : '';\r\n        var attrAppendPad = (item.appendpad != null) ? item.appendpad : '';\r\n\r\n        attr.value = attrPrepend + attrPrependPad + attrValue + attrAppendPad + attrAppend;\r\n        element.setAttributeNode(attr);\r\n        break;\r\n    }\r\n\r\n  }\r\n\r\n  //SET VALUE ONCE TO PREVENT FOIT - FLASH OF INVISIBLE TEXT\r\n  if (value != '') {\r\n    if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea') {\r\n      element.value = value;\r\n    } else {\r\n      element.innerHTML = value;\r\n    }\r\n  }\r\n}\r\n\r\nfunction SetNavState(navelement, thisobj, condition) {\r\n  //use NodeIterator.previousNode() to find container and the classes for enabled and disabled\r\n  if (!navelement.classList.contains(thisobj.state.classactive)) {\r\n    if (typeof condition.removeattribute != 'undefined') {\r\n      navelement.removeAttribute(condition.removeattribute);\r\n    }\r\n    if (typeof condition.setattribute != 'undefined') {\r\n      var attrvalue = '';\r\n      if (typeof condition.setattributevalue != 'undefined') {\r\n        attrvalue = condition.setattributevalue;\r\n      }\r\n      navelement.setAttribute(condition.setattribute, attrvalue);\r\n    }\r\n    if (condition.type == 'disabled') {\r\n      navelement.classList.remove(thisobj.state.classenabled);\r\n      navelement.classList.add(thisobj.state.classdisabled);\r\n    } else {\r\n      navelement.classList.remove(thisobj.state.classdisabled);\r\n      navelement.classList.add(thisobj.state.classenabled);\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction SanitizeNumber(_this) {\r\n  return _this.replace(/[^0-9]/g, '');\r\n}\r\n\r\nfunction Transform(value, actions) {\r\n  for (let action of actions) {\r\n    switch (action) {\r\n      case 'sanitize':\r\n        value = SanitizeNumber(item.value);\r\n        break;\r\n      case 'upper':\r\n        value = item.value.toUpperCase();\r\n        break;\r\n      case 'lower':\r\n        value = item.value.toLowerCase();\r\n        break;\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\n//let unsubscribe = clicks$.subscribe({\r\n//  next(val) { console.log(val) },\r\n//  error(e) { console.log(e) },\r\n//  complete() { console.log('complete event') }\r\n//});\r\n\r\n//setTimeout(() => unsubscribe(), 10000);\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//SAMPLE TO TEST OBSERVABLE ARRAY; SOMETHING HAPPENS FOR EACH ARRAY ELEMENT\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//let array$ = Observable.fromArray([1, 2, 3, 4]);\r\n//array$.subscribe({\r\n//  next(val) { console.log(val) },\r\n//  error(e) { console.log(e) },\r\n//  complete() { console.log('complete array ') }\r\n//});\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n//TEST OBSERVABLE 2 \r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\nclass Observable2 {\r\n  constructor(functionThatTakesObserver) {\r\n    this._functionThatTakesObserver = functionThatTakesObserver;\r\n  }\r\n\r\n  subscribe(observer) {\r\n    return this._functionThatTakesObserver(observer)\r\n  }\r\n}\r\n\r\n//instance of observable\r\n//let myObservable = new Observable(observer => {\r\n//  setTimeout(() => {\r\n//    observer.next(\"got data!\")\r\n//    observer.complete()\r\n//  }, 5000)\r\n//})\r\n\r\n///*\r\n// need key up vs blur observable\r\n// one updates visual observers and the other updates the store \r\n// we don't want to update the store on every key stroke\r\n// */\r\n\r\n//let myObserver = {\r\n//  next(data) {\r\n//    console.log(data)\r\n//  },\r\n//  error(e) {\r\n//    console.log(e)\r\n//  },\r\n//  complete() {\r\n//    console.log(\"request complete\")\r\n//  }\r\n//}\r\n\r\n//myObservable.subscribe(myObserver)\r\n//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\r\nvar boltObj = function () {\r\n  var _baseurl = \"http://rock.skedmark.com/xhr\";\r\n  var datasets = datasets || [];\r\n\r\n  function buildFormData(formData, data, parentKey) {\r\n    if (data && typeof data === 'object' && !(data instanceof Date) && !(data instanceof File)) {\r\n      Object.keys(data).forEach(key => {\r\n        buildFormData(formData, data[key], parentKey ? `${parentKey}[${key}]` : key);\r\n      });\r\n    } else {\r\n      const value = data == null ? '' : data;\r\n      formData.append(parentKey, value);\r\n    }\r\n  }\r\n\r\n  function objToFormData(data) {\r\n    const formData = new FormData();\r\n\r\n    buildFormData(formData, data);\r\n    return formData;\r\n  }\r\n\r\n  function getHelp() {\r\n    var help = {};\r\n    help.elements = [];\r\n\r\n    helpobj = {};\r\n    helpobj.attribute = \"data-route\";\r\n    helpobj.target = \"id of <view> element\";\r\n\r\n    //helpobj = { \"attribute\": \"data-route\" };\r\n    //helpobj = { \"target\": \"id of <view> element\" };\r\n    //helpobj = { \"target\": [{ \"name\": \"target_id\", \"condition\": { \"datasource\": \"name of datasource to check\", \"datafield\": \"field or column of data\", \"value\": \"value of that data\" } }] };\r\n    //helpobj = { \"description\": \"trigger to route to a single view within a SPA. Target can be a single object to link or an array with route determined by logic\" };\r\n    help.elements.push(helpobj);\r\n\r\n    helpobj = {};\r\n    helpobj.attribute = \"data-routecontainer\";\r\n    helpobj.target = \"id of container for data-route elements\";\r\n    help.elements.push(helpobj);\r\n\r\n    return help;\r\n  }\r\n\r\n  function InitializeObservables() {\r\n    //console.log('InitializeObservables() #####################################################################################################');\r\n    return new Promise(function (success, error) {\r\n\r\n      var elements = document.querySelectorAll('[data-observe]'); // All with attribute named \"property\"\r\n      for (let element of elements) {\r\n        //console.log('element:', element);\r\n\r\n        let observe = element.getAttribute('data-observe');\r\n        var _ds = 'store';\r\n        var _df = '';\r\n\r\n        //assuming multiple things can be done on item; perhaps populate then clone then set to uppercase\r\n        for (let item of JSON.parse(observe)) {\r\n          //var item = JSON.parse(observe)[0];\r\n\r\n          if (typeof item.datasource !== 'undefined') {\r\n            //console.log('item.datasource', item);\r\n            //console.log('item.datasource', item.datasource);\r\n            if (Array.isArray(item.datasource)) {\r\n              for (let _ds of item.datasource) {\r\n                _ds = _ds.replace(/-/g, \"_\");\r\n                if (_ds != '') {//template will only have datasource and not datafield\r\n                  element.classList.add('dataset-' + classRnd + '-' + _ds);\r\n                }\r\n              }\r\n            } else {\r\n              _ds = item.datasource.replace(/-/g, \"_\");\r\n              if (_ds != '') {//template will only have datasource and not datafield\r\n                element.classList.add('dataset-' + classRnd + '-' + _ds);\r\n              }\r\n            }\r\n          }\r\n\r\n          if (typeof item.value !== 'undefined') {\r\n            _df = item.value;\r\n          }\r\n\r\n          if (_df != '') {\r\n            element.classList.add('datafield-' + classRnd + '-' + _df);\r\n          }\r\n        }\r\n      }\r\n      success('done'); // when successful\r\n      error();  // when error\r\n    });\r\n\r\n  }\r\n\r\n  function InitialRoute() {\r\n    //console.log('InitialRoute() #####################################################################################################');\r\n    return new Promise(function (success, error) {\r\n      /*\r\n         loop over all [data-view]\r\n         default views will have data-view attribute \r\n         attribute will include logic to decide which view for the route\r\n\r\n        e.g.\r\n        <view id=\"view1\" data-view='{\"default\":\"true\",\"condition\":{\"datasource\":\"public-organization-details-get\",\"datafield\":\"attacheddevice\",\"value\":\"true\"}}'>\r\n\r\n        verify default is true\r\n        process logic to true or false\r\n\r\n        don't forget to set the nav classes\r\n       */\r\n\r\n\r\n      var _ds = 'store';\r\n      var views = document.querySelectorAll('[data-view]'); // All with attribute named [this]\r\n      for (let view of views) {\r\n        let viewjson = view.getAttribute('data-view');\r\n\r\n        var obj = JSON.parse(viewjson);\r\n\r\n        //attribute should always have a default value; for now\r\n        if (typeof obj.default !== 'undefined') {\r\n          if (typeof obj.condition !== 'undefined') {\r\n\r\n            if (typeof obj.condition.datasource !== 'undefined') {\r\n              _ds = obj.condition.datasource;\r\n              _ds = _ds.replace(/-/g, \"_\");\r\n            }\r\n\r\n            if (_rex.datasets[_ds].data[0][obj.condition.datafield] == obj.condition.value) {\r\n              //SET NAV CLASS THEN SHOW VIEW\r\n              //console.log('FOUND DEFAULT VIEW #####################################');\r\n              //NAV ROUTE ##############################################################\r\n              var routecontainers = document.querySelectorAll('[data-routecontainer]');\r\n              //could be more than one\r\n              if (typeof routecontainers != \"undefined\") {\r\n                for (let routecontainer of routecontainers) {\r\n                  //console.log('WORKING ROUTE CONTAINER ');\r\n                  let routecontainerjson = routecontainer.getAttribute('data-routecontainer');\r\n                  var routecontainerobj = JSON.parse(routecontainerjson);\r\n                  var states = routecontainerobj.classstates;\r\n\r\n                  var routes = routecontainer.querySelectorAll('[data-route]'); // All with attribute named \"property\"\r\n                  for (let route of routes) {\r\n                    var routeobj = JSON.parse(route.getAttribute('data-route'));\r\n                    //console.log('WORKING NAV ROUTE ', route);\r\n                    //if route matches initial view\r\n                    if (Array.isArray(routeobj.target)) {\r\n                      //this means target is conditional and points to more than one view\r\n                      //if any of the views match the view id then set to active\r\n                      //console.log('LOOKING FOR ', view.id);\r\n                      for (let target of routeobj.target) {\r\n                        //console.log('TARGET ', target.name);\r\n                        if (target.name == view.id) {\r\n                          route.classList.remove(states.enabled);//in case all nav routes have enabled; should all potential classes be removed\r\n                          route.classList.add(states.active);\r\n                          break;\r\n                        }\r\n                      }\r\n                    } else {\r\n                      //console.log('TARGET ', routeobj.target);\r\n                      if (routeobj.target == view.id) {\r\n                        route.classList.remove(states.enabled);//in case all nav routes have been enabled; should all potential classes be removed\r\n                        route.classList.add(states.active);\r\n                        break;\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              } else {\r\n                //no route container so where do we get classes to use\r\n              }\r\n              //END NAV ROUTE ##############################################################\r\n\r\n              view.style.display = 'block';\r\n              break;\r\n            }\r\n          } else {\r\n            //need to set nav route class here too; create function call to keep DRY\r\n            //this is the default view and should be the one and only\r\n            view.style.display = 'block';\r\n          }\r\n        }\r\n      }\r\n      /*\r\n       we could error if we don't find good view\r\n       options\r\n       show first view element \r\n       if view options are set we can offer a code generated error view\r\n       */\r\n      success('done'); // when successful\r\n      error();  // when error\r\n    });\r\n\r\n  }\r\n\r\n  function APICall(apiobject) {\r\n    return new Promise((resolve, reject) => {\r\n      //replace all other xhr functions with this\r\n      /*\r\n       if apiobject is a string then it is likely initial setup; could use switch/unum for load, remote, and lazyload\r\n  \r\n  \r\n       */\r\n      var formData = objToFormData(_rex.datasets.persistent.data[0]);\r\n      var _submit = true;\r\n\r\n      //options\r\n      //var b_idempotent = ($(_thisId).attr('data-meta-idempotent')) ? true : false;\r\n      //if event trigger\r\n      //if (b_idempotent) {\r\n      //  $(_thisId).prop(\"disabled\", true);\r\n      //}\r\n\r\n      //ALWAYS INCLUDE JWT\r\n      //if (typeof JWT !== 'undefined') {\r\n      //  var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": \"JWT\" }).val(JWT);\r\n      //  $('#' + _form).append(input);\r\n      //}\r\n\r\n      /*\r\n       IF MODAL THEN THERE IS USUALLY A WAIT MESSAGE AND RETURN MESSAGE\r\n       HANDLE PROGRESS BAR?\r\n       INCLUDE IDEMPOTENT STAMP; MEH JUST DO IT\r\n       CHECK FOR VALIDATION; FORM BY FORM OR SPECIFIC ELEMENTS AS INDICATED BY THIS\r\n       JSON/ARRRAY LIKE OBJECT SHOULD BE STRINGIFIED\r\n       FOR EACH FORM LOOP OVER AND INCLUDE EACH INPUT\r\n            $.each(_forms, function (n, v) {\r\n            $('#' + v.form + ' *').filter(':input').each(function () {\r\n              $(this).clone().appendTo($('#' + _form));\r\n            });\r\n\r\n       ///ADD ANY SORTABLE ELEMENTS\r\n            $('#' + v.form).find('[data-include-in-form] li').each(function () {\r\n              var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": $(this).data('fieldname') }).val($(this).data('id'));\r\n              $('#' + _form).append(input);\r\n            });\r\n\r\n      ///ADD DATATABLE SELECT ELEMENTS IF WITHIN FORM\r\n            $('#' + v.form).find('table[data-tableselect=\"true\"]').each(function () {\r\n              var fieldname = $(this).attr('data-fieldname');\r\n              var dataelement = $(this).attr('data-dataelement');\r\n              var _items = [];\r\n              var table = $('#' + $(this).attr('id')).DataTable();\r\n              for (let i = 0; i < table.rows({ selected: true }).data().length; i++) {\r\n                _items.push(table.rows({ selected: true }).data()[i][dataelement]);\r\n              }\r\n              var _itemsdelimited = _items.join(\",\");\r\n              var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": fieldname }).val(_itemsdelimited);\r\n              $('#' + _form).append(input);\r\n            });\r\n\r\n       SEND; LOAD; HANDLE PROGRESS\r\n        xhr.open\r\n        xhr.onload\r\n        xhr.status ;https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\r\n          Informational responses (100  199)\r\n          Successful responses (200  299)\r\n          Redirection messages (300  399)\r\n          Client error responses (400  499)\r\n          Server error responses (500  599)\r\n        .readyState ;https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\r\n          0\tUNSENT\tClient has been created. open() not called yet.\r\n          1\tOPENED\topen() has been called.\r\n          2\tHEADERS_RECEIVED\tsend() has been called, and headers and status are available.\r\n          3\tLOADING\tDownloading; responseText holds partial data.\r\n          4\tDONE\tThe operation is complete.\r\n        xhr.responseText\r\n\r\n    //    xhr.onreadystatechange = function () {\r\n    //      if (xhr.readyState == 4 && xhr.status == 200) {\r\n\r\n      onloadstart\r\n      onprogress\t\r\n      onabort\t\r\n      onerror\t\r\n      ontimeout\t\r\n      onloadend\t\r\n\r\n       */\r\n\r\n\r\n      console.log('APICall(apiobject)');\r\n      console.log('apiobject', apiobject);\r\n\r\n      var _url = _baseurl;\r\n      var _method = \"POST\";//DEFAULT IS POST; USE OPTIONS TO CHANGE\r\n\r\n      //crud always needs \"queries\" object with name of procedures to execute\r\n      var xhrObj = { queries: [] };\r\n\r\n      if (typeof apiobject == 'string') {\r\n        //get object from dom\r\n        if (apiobject == 'remote') {\r\n          //######################################################################################################################\r\n          //THIS DOES NOT ALLOW FOR MULTIPLE REMOTE CALLS, A BIT UNIQUE IN THAT SENSE; todo fix\r\n          //uniquely, remote can make multiple api calls; should this be handled within apicontrol? and passed in as method call\r\n          //load and lazy load are each a single call\r\n          //######################################################################################################################\r\n          for (let ds of _datasetsinit[apiobject]) {\r\n            _thisDatasetRemote = ds.dataset;\r\n            _url = ds.url;\r\n            _method = (typeof ds.method != 'undefined') ? ds.method : _method;\r\n          }\r\n        }\r\n\r\n        for (let ds of _datasetsinit[apiobject]) {\r\n          if (typeof ds == 'string') {\r\n            var queryObj = { query: { name: ds, datasets: [{ dataset: ds }] } };\r\n            xhrObj.queries.push(queryObj);\r\n\r\n          } else if (typeof ds == 'object' && typeof ds.dataset != 'undefined') {\r\n            //{ \"query\": \"formfield_firstname\", \"dataset\": \"firstnames\" }, //example\r\n            var queryObj = { query: { name: ds.query, datasets: [{ dataset: ds.dataset }] } };\r\n            xhrObj.queries.push(queryObj);\r\n\r\n          } else if (typeof ds == 'object' && typeof ds.datasets != 'undefined') {\r\n            //{ \"query\": \"public-get\", \"datasets\": [\"staff\", \"locations\", \"services\"] }//example\r\n            var _datasets = [];\r\n            for (let datasetname of ds.datasets) {\r\n              var resultset = {};\r\n              resultset.dataset = datasetname;\r\n              _datasets.push(resultset);\r\n            }\r\n            var queryObj = { query: { name: ds, datasets: _datasets } };\r\n            xhrObj.queries.push(queryObj);\r\n            //returns; {query:\"public-get\", datasets: [ {\"dataset\": \"staff\"}, { \"dataset\": \"locations\"}, { \"dataset\": \"services\"} ]}\r\n          }\r\n        }\r\n        formData.append('queries', JSON.stringify(xhrObj.queries));\r\n\r\n      } else if (typeof apiobject == 'object') {\r\n        console.log('process as object rather than string');\r\n        //set all the form data\r\n\r\n        //object is added to apicontrol.queue\r\n        //object contains type: event/method; i.e. dom element event or direct method call\r\n\r\n        /*\r\n        var apiobject = {};\r\n        apiobject.type = 'method'; //vs event\r\n        apiobject.object = object;\r\n        apicontrol.start(apiobject);\r\n\r\n        the question becomes, what is in the object\r\n\r\n\r\n        //dom element event triggered i.e. button click; pending slot\r\n        //ex: \r\n        the trigger json should be something like \r\n        [{\"type\":\"api\", \"queries\":[\"string array or object array to return aliases etc\"], \"prepromise\":\"function name\", \"postpromise\":\"function name\"\r\n        , \"options\":[{\"method\":\"post\"}, {\"url\":\"if set this is http not xhr\"}, {\"target\":\"if http/blank, self etc\"}, {\"method\":\"post\"}], \"forms\":[\"form1\", \"form2\"], \"dataobjects\":[\"cart\"]}, {another action perhaps}]\r\n        //review data-meta-jsonarray; used some technique to pass array data to the server for perform stuff me thinks\r\n        //manually called\r\n        //\r\n        ex: \r\n        OLD VERSION \r\n        var xhrObj = { queries: '[{\"query\":\"public-availabilty-get\"}]', start: _startdate, end: _enddate, staff: _thisStaff, services: servicesArr.join(\",\"), locationguid: _locationguid };\r\n        var queryObj = { query: { name: _datasetNameOrg, datasets: [{ dataset: _datasetNameOrg }] } };\r\n        xhrObj.queries.push(queryObj);\r\n        pageObj.CallXHR(xhrObj, XHRFinally); //call method with callback\r\n\r\n        NEW VERSION\r\n        use apostrophe so payload just passes string to server which then processes as array\r\n        { queries: '{ \"query\": \"formfield_firstname\", \"dataset\": \"firstnames\" }, { \"query\": \"public-get\", \"datasets\": [ \"staff\", \"locations\", \"services\"]}],\r\n        auto include quer; just use string array for devs to use\r\n        string array format\r\n        {\"options\":[\"option_name\":\"yet to be determined options\"], \"prepromise\":\"function to call before api call; to manipulate dates or something\", \"postpromise\":\"function to call on return\", \"another_parameter\":\"another value\", \"queries\": [\"formfield_firstname\", \"public-client-profile-list\", \"public-location-get\", \"public-services-get\", \"public-organization-details-get\", \"public-add-ons-get\"]},\r\n        object array to control dataset alias and multiple resultsets\r\n        \"queries\": [{ \"query\": \"formfield_firstname\", \"dataset\": \"firstnames\" }, { \"query\": \"public-get\", \"datasets\": [ \"staff\", \"locations\", \"services\"]}],\r\n\r\n        so rather than old dom/attribute way and direct call json \r\n        both ways use json to provide consistency and flexibility\r\n\r\n        add ability to create own option that calls custom function and expects return of object array that will pass values to server as name value pairs\r\n        easy peasy\r\n\r\n       */\r\n\r\n      }\r\n\r\n      //######################################################################################################################\r\n      //PROCESS XHR HERE\r\n      //######################################################################################################################\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open(_method, _url, true);\r\n\r\n\r\n\r\n      xhr.onload = function () {\r\n        if (xhr.status === 200) {\r\n          if (xhr.responseText.length > 0) {\r\n            ///VALUE TO BE SUBMITTED WITH SUBSEQUENT REQUEST SO DUPLICATE PHOTOS ARE NOT CONTINUALLY ADDED TO SERVER\r\n            try {\r\n              var jsonObj = JSON.parse(xhr.responseText);\r\n              //console.log('jsonObj', jsonObj);\r\n              //this is a hardcoded version for hacker news which returns array data\r\n              //xhr.responseText could be a string, array or object\r\n              //MULTIPLE DATASETS MIGHT BE RETURNED \r\n              //CREATE A META DATA RESPONSE WITH INFORMATION SUCH AS #DATASETS, A MESSAGE, WHAT ELSE?\r\n\r\n              if (Array.isArray(jsonObj)) {\r\n                //console.log('THIS IS AN ARRAY RESPONSE HACK @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@');\r\n                _rex.datasets[_thisDatasetRemote] = {};\r\n                function all() { return this.data }\r\n                _rex.datasets[_thisDatasetRemote].all = all;\r\n                _rex.datasets[_thisDatasetRemote].meta = { \"object\": \"false\" };\r\n                _rex.datasets[_thisDatasetRemote].data = jsonObj;\r\n\r\n              } else {\r\n                for (let obj of jsonObj.root) {\r\n                  var ds = Object.keys(obj)[0];\r\n\r\n                  //name of dataset\r\n                  //console.log('Object.keys(obj)[0]', Object.keys(obj)[0]);\r\n                  //console.log('ARRAY', obj[Object.keys(obj)[0]]);\r\n                  var data = obj[Object.keys(obj)[0]];\r\n                  //console.log('data', data);\r\n                  var _thisDataset = Object.keys(obj)[0].replace(/-/g, \"_\");\r\n                  _rex.datasets[_thisDataset] = {};\r\n\r\n                  function load(dataset) {\r\n                    this.tbl = JSON.parse(sessionStorage.getItem(dataset))\r\n                  }\r\n                  function unload() {\r\n                    this.tbl = [];\r\n                  }\r\n                  function all() { return this.data }\r\n                  function where() { return null }\r\n                  function save() { return null }\r\n                  //_rex.datasets[Object.keys(obj)[0]].load = load;\r\n                  //_rex.datasets[Object.keys(obj)[0]].unload = unload;\r\n                  //_rex.datasets[Object.keys(obj)[0]].where = where;\r\n                  //_rex.datasets[Object.keys(obj)[0]].load(dataset);\r\n                  _rex.datasets[_thisDataset].all = all;\r\n\r\n                  //_rex.datasets[Object.keys(obj)[0]] = data;\r\n                  _rex.datasets[_thisDataset].meta = { \"object\": \"false\" };\r\n                  _rex.datasets[_thisDataset].data = obj[Object.keys(obj)[0]];\r\n\r\n                  //console.log('Table obj[Object.keys(obj)[0]][0]', obj[Object.keys(obj)[0]][0]);\r\n                  var _dataset = ds.replace(/-/g, \"_\");\r\n\r\n\r\n                }\r\n                _xhrprocessing = false;\r\n                typeof cb === 'function' && cb(cbArguments);\r\n\r\n              }\r\n              resolve(); // when successful\r\n\r\n            } catch (e) {\r\n              //console.log('e',e);\r\n              var cleanAttempt = '{\"root\":[' + xhr.responseText.replace(/}{/g, \"},{\") + ']}';\r\n              var cleanObj = JSON.parse(cleanAttempt)\r\n              try {\r\n                var jsonObj = cleanObj['root'][cleanObj['root'].length - 1];\r\n                for (let obj of jsonObj.root) {\r\n                  addDataset(obj, Object.keys(obj)[0]);\r\n                  //console.log('clean');\r\n                  //console.log('obj', obj);\r\n                  //console.log('Object.keys(obj)[0]', Object.keys(obj)[0]);\r\n                  var _dataset = Object.keys(obj)[0].replace(/-/g, \"_\");\r\n                  if (obj[Object.keys(obj)[0]].length == 1) {\r\n                    //console.log('save to sessionStorage 3');\r\n                    //sessionStorage.setItem(Object.keys(obj)[0], JSON.stringify(obj[Object.keys(obj)[0]][0]));\r\n                    function all() { return obj[Object.keys(obj)[0]][0] }\r\n                  } else {\r\n                    if (obj[Object.keys(obj)[0]].length > 0) {\r\n                      //console.log('save to sessionStorage 4');\r\n                      //sessionStorage.setItem(Object.keys(obj)[0], JSON.stringify(obj[Object.keys(obj)[0]]));\r\n                      function all() { return obj[Object.keys(obj)[0]] }\r\n                    } else {\r\n                      console.log('not saving to sessionStorage catch');\r\n                    }\r\n                  }\r\n                  //this.tbl = JSON.parse(sessionStorage.getItem(dataset))\r\n                  //function all() { return obj[Object.keys(obj)[0]][0] }\r\n                  //DB[_dataset].load = load;\r\n                  //DB[_dataset].load();\r\n                  //DB[_dataset].all = all;\r\n                }\r\n                _xhrprocessing = false;\r\n                typeof cb === 'function' && cb(cbArguments);\r\n              } catch (e) {\r\n                console.log(e);\r\n              }\r\n              reject();  // when error\r\n            }\r\n\r\n            //finally\r\n            //InitialHydrate();\r\n            //InitialRoute();\r\n          }\r\n        } else {\r\n          _xhrprocessing = false;\r\n          typeof cb === 'function' && cb(false);\r\n        }\r\n      };\r\n      /// Send the Data.\r\n      xhr.send(formData);\r\n    });\r\n\r\n  }\r\n\r\n  function dbXHR() {\r\n    //console.log('dbXHR() #####################################################################################################');\r\n    return new Promise((resolve, reject) => {\r\n\r\n      var xhrArgs = arguments[0];\r\n      //var cb = arguments[1];\r\n      //var _len = arguments.length\r\n      //while (arguments.length > _len - 2) {\r\n      //  Array.prototype.shift.apply(arguments);\r\n      //}\r\n      var _url = \"http://rock.skedmark.com/xhr\";\r\n      var _method = \"POST\";//DEFAULT IS POST; USE OPTIONS TO CHANGE\r\n      var _thisDatasetRemote;\r\n      if (xhrArgs == 'remote') {\r\n\r\n        //######################################################################################################################\r\n        //THIS DOES NOT ALLOW FOR MULTIPLE REMOTE CALLS, A BIT UNIQUE IN THAT SENSE; todo fix\r\n        //######################################################################################################################\r\n        for (let ds of _datasetsinit[xhrArgs]) {\r\n          _thisDatasetRemote = ds.dataset;\r\n          _url = ds.url;\r\n          _method = (typeof ds.method != 'undefined') ? ds.method : _method;\r\n        }\r\n      }\r\n      //console.log('typeof xhrArgs', typeof xhrArgs);\r\n      console.log('xhrArgs', xhrArgs);\r\n\r\n      //get external data sources working\r\n\r\n      //this is the initializing code which needs to hydrate after server call; but it replicates regular xhr call so pass in cb for hydrate\r\n      //or should hydrate always happen when new data is retrieved\r\n\r\n      //var argObj = arguments[0];\r\n      //var cb = arguments[1];\r\n      //var _len = arguments.length\r\n\r\n      //while (arguments.length > _len - 2) {\r\n      //  Array.prototype.shift.apply(arguments);\r\n      //}\r\n      //var cbArguments;\r\n      //if (typeof arguments != 'undefined' && arguments.length > 0) {\r\n      //  cbArguments = arguments[0];\r\n      //}\r\n\r\n\r\n      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n      ///CREATE FORM OBJECT\r\n      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n      //add persistent data; only what is explicitly included; passing request params arbitrarily will result in unexpected consequences\r\n      var formData = objToFormData(_rex.datasets.persistent.data[0]);\r\n\r\n      //console.log('_rex.datasets', _rex.datasets);\r\n\r\n      //add _datasets as queries\r\n      var xhrObj = { queries: [] };\r\n      //var _cleanDatasets = _datasets.system.replace(/-/g, \"_\");\r\n      console.log('_datasetsinit', _datasetsinit, xhrArgs);\r\n      console.log('_datasetsinit', _datasetsinit[xhrArgs]);\r\n\r\n      //could handle dataset aliases here; if typeof ds == 'string' then no alias; \r\n      //if object then could be array of single procedure/alias ojects { \"query\": \"clients\", \"dataset\": \"clients\" }\r\n      //if object has \"datasets\" element then multiple results expected for query; datasets: [{ \"dataset\": \"clients\" }, { \"dataset\": \"barbers\" }]\r\n\r\n\r\n\r\n      //THIS WORKS FOR INITIAL API DATA REQUESTS AND MANUAL API CALLS USING 3 DIFFERENT FORMATS; STRING, ALIAS, AND MULTIPLE RESULTS FROM SINGLE QUERY\r\n      //ALLOW REMOTE TO SET METHOD (POST/GET) ETC; ADDITIONA PARAMS; LETS CALL THESE OPTIONS\r\n      //EACH REMOTE CALL SHOULD ALLOW FOR CUSTOM OPTIONS\r\n      //NOW HANDLE TRIGGERED ELEMENTS LIKE BUTTON CLICKS\r\n      //THIS WOULD ONLY BE FOR THE QUERIES CALLED; FORMS AND CRUD OBJECTS ARE POPULATED DIFFERENTLY\r\n      for (let ds of _datasetsinit[xhrArgs]) {\r\n        if (typeof ds == 'string') {\r\n          var queryObj = { query: { name: ds, datasets: [{ dataset: ds }] } };\r\n          xhrObj.queries.push(queryObj);\r\n\r\n        } else if (typeof ds == 'object' && typeof ds.dataset != 'undefined') {\r\n          //{ \"query\": \"formfield_firstname\", \"dataset\": \"firstnames\" }, //example\r\n          var queryObj = { query: { name: ds.query, datasets: [{ dataset: ds.dataset }] } };\r\n          xhrObj.queries.push(queryObj);\r\n\r\n        } else if (typeof ds == 'object' && typeof ds.datasets != 'undefined') {\r\n          //{ \"query\": \"public-get\", \"datasets\": [\"staff\", \"locations\", \"services\"] }//example\r\n          var _datasets = [];\r\n          for (let datasetname of ds.datasets) {\r\n            var resultset = {};\r\n            resultset.dataset = datasetname;\r\n            _datasets.push(resultset);\r\n          }\r\n          var queryObj = { query: { name: ds, datasets: _datasets } };\r\n          xhrObj.queries.push(queryObj);\r\n          //returns; {query:\"public-get\", datasets: [ {\"dataset\": \"staff\"}, { \"dataset\": \"locations\"}, { \"dataset\": \"services\"} ]}\r\n        }\r\n      }\r\n\r\n\r\n      //console.log('xhrObj.queries', xhrObj.queries);\r\n      formData.append('queries', JSON.stringify(xhrObj.queries));\r\n      //add JWT\r\n      //formData.append('JWT', JWT);\r\n\r\n      for (let [name, value] of formData) {\r\n        //alert(`${name} = ${value}`); // key1 = value1, then key2 = value2\r\n        //console.log(`${name} = ${value}`);\r\n      }\r\n\r\n      //var _url = \"http://rock.skedmark.com/xhr\";\r\n      _xhrprocessing = true;\r\n      xhr = new XMLHttpRequest();\r\n      xhr.open(_method, _url, true);\r\n\r\n      xhr.onload = function () {\r\n        if (xhr.status === 200) {\r\n          if (xhr.responseText.length > 0) {\r\n            ///VALUE TO BE SUBMITTED WITH SUBSEQUENT REQUEST SO DUPLICATE PHOTOS ARE NOT CONTINUALLY ADDED TO SERVER\r\n            try {\r\n              var jsonObj = JSON.parse(xhr.responseText);\r\n              //console.log('jsonObj', jsonObj);\r\n              if (Array.isArray(jsonObj)) {\r\n                //console.log('ARRAY @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@');\r\n                //check if remote\r\n                _rex.datasets[_thisDatasetRemote] = {};\r\n                function all() { return this.data }\r\n                _rex.datasets[_thisDatasetRemote].all = all;\r\n                _rex.datasets[_thisDatasetRemote].meta = { \"object\": \"false\" };\r\n                _rex.datasets[_thisDatasetRemote].data = jsonObj;\r\n\r\n              } else {\r\n                for (let obj of jsonObj.root) {\r\n                  var ds = Object.keys(obj)[0];\r\n\r\n                  /*\r\n                   create function to create dataset under .data \r\n                   add functions to manage dataset\r\n                   */\r\n\r\n                  //add dataset to _rex object\r\n                  //addDataset(obj, ds);\r\n                  //console.log('load');\r\n                  //console.log('obj', obj);\r\n\r\n                  //name of dataset\r\n                  //console.log('Object.keys(obj)[0]', Object.keys(obj)[0]);\r\n                  //console.log('ARRAY', obj[Object.keys(obj)[0]]);\r\n                  var data = obj[Object.keys(obj)[0]];\r\n                  //console.log('data', data);\r\n                  var _thisDataset = Object.keys(obj)[0].replace(/-/g, \"_\");\r\n\r\n                  _rex.datasets[_thisDataset] = {};\r\n\r\n                  function load(dataset) {\r\n                    this.tbl = JSON.parse(sessionStorage.getItem(dataset))\r\n                  }\r\n                  function unload() {\r\n                    this.tbl = [];\r\n                  }\r\n                  function all() { return this.data }\r\n                  function where() { return null }\r\n                  function save() { return null }\r\n                  //_rex.datasets[Object.keys(obj)[0]].load = load;\r\n                  //_rex.datasets[Object.keys(obj)[0]].unload = unload;\r\n                  //_rex.datasets[Object.keys(obj)[0]].where = where;\r\n                  //_rex.datasets[Object.keys(obj)[0]].load(dataset);\r\n                  _rex.datasets[_thisDataset].all = all;\r\n\r\n\r\n\r\n                  //_rex.datasets[Object.keys(obj)[0]] = data;\r\n\r\n                  _rex.datasets[_thisDataset].meta = { \"object\": \"false\" };\r\n                  _rex.datasets[_thisDataset].data = obj[Object.keys(obj)[0]];\r\n\r\n\r\n                  //\r\n                  //console.log('Table obj[Object.keys(obj)[0]][0]', obj[Object.keys(obj)[0]][0]);\r\n                  var _dataset = ds.replace(/-/g, \"_\");\r\n                  //console.log('DB[dataset]: ' + DB[_dataset]);\r\n\r\n                  //if (DB[_dataset] != undefined) {\r\n                  //  //console.log('_dataset: ' + _dataset);\r\n                  //  if (obj[ds].length == 1) {\r\n\r\n                  //    //function load(dataset) {\r\n                  //    //console.log('attempting to load ' + dataset);\r\n                  //    //console.log('Cached?', sessionStorage.getItem(dataset));\r\n                  //    //  this.tbl = JSON.parse(sessionStorage.getItem(dataset))\r\n                  //    //}\r\n                  //    ///SET DB[DATASET] TO NEW LOAD FUNCTION\r\n\r\n                  //    //console.log('save to sessionStorage');\r\n                  //    //sessionStorage.setItem(ds, JSON.stringify(obj[ds][0]));\r\n                  //    function all() { return obj[ds[0]] }\r\n                  //  } else {\r\n                  //    if (obj[ds].length > 0) {\r\n                  //      //console.log('save to sessionStorage 2');\r\n                  //      sessionStorage.setItem(ds, JSON.stringify(obj[ds]));\r\n                  //      function all() { return obj[ds] }\r\n                  //    } else {\r\n                  //      //console.log('not saving to sessionStorage', obj[Object.keys(obj)[0]]);\r\n                  //    }\r\n                  //  }\r\n\r\n                  //  DB[_dataset].load(ds);\r\n\r\n                  //}\r\n                  //console.log('obj[Object.keys(obj)[0]].length', obj[Object.keys(obj)[0]].length);\r\n\r\n                }\r\n                _xhrprocessing = false;\r\n                typeof cb === 'function' && cb(cbArguments);\r\n\r\n              }\r\n\r\n\r\n              resolve('done'); // when successful\r\n\r\n            } catch (e) {\r\n              //console.log('e',e);\r\n              var cleanAttempt = '{\"root\":[' + xhr.responseText.replace(/}{/g, \"},{\") + ']}';\r\n              var cleanObj = JSON.parse(cleanAttempt)\r\n              try {\r\n                var jsonObj = cleanObj['root'][cleanObj['root'].length - 1];\r\n                for (let obj of jsonObj.root) {\r\n                  addDataset(obj, Object.keys(obj)[0]);\r\n                  //console.log('clean');\r\n                  //console.log('obj', obj);\r\n                  //console.log('Object.keys(obj)[0]', Object.keys(obj)[0]);\r\n                  var _dataset = Object.keys(obj)[0].replace(/-/g, \"_\");\r\n                  if (obj[Object.keys(obj)[0]].length == 1) {\r\n                    //console.log('save to sessionStorage 3');\r\n                    //sessionStorage.setItem(Object.keys(obj)[0], JSON.stringify(obj[Object.keys(obj)[0]][0]));\r\n                    function all() { return obj[Object.keys(obj)[0]][0] }\r\n                  } else {\r\n                    if (obj[Object.keys(obj)[0]].length > 0) {\r\n                      //console.log('save to sessionStorage 4');\r\n                      //sessionStorage.setItem(Object.keys(obj)[0], JSON.stringify(obj[Object.keys(obj)[0]]));\r\n                      function all() { return obj[Object.keys(obj)[0]] }\r\n                    } else {\r\n                      console.log('not saving to sessionStorage catch');\r\n                    }\r\n                  }\r\n                  //this.tbl = JSON.parse(sessionStorage.getItem(dataset))\r\n                  //function all() { return obj[Object.keys(obj)[0]][0] }\r\n                  //DB[_dataset].load = load;\r\n                  //DB[_dataset].load();\r\n                  //DB[_dataset].all = all;\r\n                }\r\n                _xhrprocessing = false;\r\n                typeof cb === 'function' && cb(cbArguments);\r\n              } catch (e) {\r\n                console.log(e);\r\n              }\r\n              reject();  // when error\r\n            }\r\n\r\n            //todo: make hydrate a promise followed by lazy load\r\n            //add view load any time view changes; add flag to call only once vs multiple times\r\n            //finally\r\n            //InitialHydrate();\r\n            //InitialRoute();\r\n          }\r\n        } else {\r\n          _xhrprocessing = false;\r\n          typeof cb === 'function' && cb(false);\r\n        }\r\n      };\r\n      /// Send the Data.\r\n      xhr.send(formData);\r\n    });\r\n  }\r\n\r\n\r\n  /*\r\n   TRY SOMETHING LIKE THIS TO CONTINUALLY UPDATE QUEUE AND RUN PROMISE\r\n \r\n function countTo(n, sleepTime) {\r\n  return _count(1);\r\n\r\n  function _count(current) {`\r\n    if (current > n) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      console.info(current);\r\n      setTimeout(function() {\r\n        resolve(_count(current + 1));\r\n      }, sleepTime);\r\n    });\r\n  }\r\n}\r\n\r\n\r\n//files is array of xhr calls; manages within function\r\n//pull araay outside function so it can be dynamic\r\nfunction recursiveDownloadChain(files){\r\n    const nextFile = files.shift();\r\n\r\n    if(nextFile){\r\n    //the function download is a promise\r\n        return download(nextFile).then(_ => recursiveDownloadChain(files))\r\n    }else{\r\n      //when all files have been processed finish/complete\r\n        return Promise.resolve();\r\n    }\r\n}\r\n\r\n//mockFiles is array of xhr calls\r\n\r\n//add xhr object to array\r\n//if array empty then call \"run\"\r\n//if array not empty then do nothing since already being run\r\n//might need to check that xhr is running or kick off again\r\n\r\n//what does xhr need to be self contained\r\n//calling element etc? via trigger or method\r\n\r\nrecursiveDownloadChain(mockFiles)\r\n.then(_ => console.log('files were downloaded in recursive chain mode'))\r\n\r\n   */\r\n\r\n\r\n  //refactor this to handle queue of xhr calls\r\n  var apicontrol = {\r\n    queue: [], // upload queue\r\n    start: function (apiobject) {\r\n      //apicontrol.start(apiobject);//call this\r\n      // WILL ONLY START IF NO EXISTING UPLOAD QUEUE\r\n      apicontrol.queue.push(apiobject);\r\n      if (apicontrol.queue.length == 1) {\r\n        apicontrol.run();\r\n      }\r\n    },\r\n    run: function () {\r\n      const apiObj = apicontrol.queue.shift();\r\n      if (apiObj) {\r\n        return APICall(apiObj).then(() => apicontrol.run())\r\n      } else {\r\n        return Promise.resolve();\r\n      }\r\n      //return;// here\r\n\r\n      //put this is separate function\r\n      var xhr = new XMLHttpRequest(),\r\n\r\n      ///SET FORM DATA\r\n      data = new FormData();\r\n\r\n      /////////////////////////////////////////////////////////////////////////////////////////////////////\r\n      xhr.open('POST', '/xhr', true);\r\n\r\n      xhr.onload = function (e) {\r\n        // SHOW UPLOAD STATUS\r\n        if (xhr.readyState === 4) {\r\n          if (xhr.status === 200) {\r\n            // SERVER RESPONSE\r\n          } else {\r\n            // ERROR\r\n            console.error('There was an error with api call');\r\n            ///DONT FAIL UNLESS TRIED 3 TIMES\r\n          }\r\n        }\r\n        if (apicontrol.queue.length > 0) {\r\n          apicontrol.run();\r\n        }\r\n      };\r\n      xhr.send(data);\r\n    }\r\n  };\r\n\r\n  //lets make this DRY\r\n  function HydrateDatasetList(list) {\r\n    //console.log('HydrateDatasetList() #####################################################################################################');\r\n    return new Promise(function (success, error) {\r\n      if (list === 'persistent_store') {\r\n        elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-store');\r\n        for (let element of elements) {\r\n          HydrateElement(element)\r\n        }\r\n      } else {\r\n        for (let _ds of _datasetsinit[list]) {\r\n          var elements;\r\n          if (typeof _ds == 'string') {\r\n            _ds = _ds.replace(/-/g, \"_\");\r\n            elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds);\r\n          } else {\r\n            _ds = _ds.dataset.replace(/-/g, \"_\");\r\n            elements = document.querySelectorAll('.' + 'dataset-' + classRnd + '-' + _ds);\r\n          }\r\n          for (let element of elements) {\r\n            HydrateElement(element)\r\n          }\r\n        }\r\n}\r\n      success('done'); // when successful\r\n      error();  // when error\r\n    });\r\n  }\r\n\r\n\r\n  function handleXHR() {\r\n\r\n    /*\r\n    init object\r\n    populate persistent store \r\n    set event handler for xhr calls\r\n    make xhr calls for page datasets\r\n    process all data-observe atributes\r\n    populate data \r\n      create classes to help populate reactive elements \r\n    update xhr calls to handle external sources\r\n\r\n\r\n     */\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    ///XHR FORM DATA TO SERVER ON ELEMENT CLICK; INCLUDE DATA ATTRIBUTES AND OTHER ELEMENTS THAT CONTAIN INPUT ELEMENTS\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //$('body').on('click change', '.form-xhr, .xhr-post', function (e) {\r\n    //  var _submit = true;\r\n    //  var _form = _xhrpostformid;\r\n    //  var _thisId = '#' + $(this).attr('id');\r\n\r\n\r\n    //  if (typeof JWT !== 'undefined') {\r\n    //    var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": \"JWT\" }).val(JWT);\r\n    //    $('#' + _form).append(input);\r\n    //  }\r\n\r\n    //  ///DISABLE ON CLICK AND ENABLE ON SUCCESS OR FAILURE\r\n    //  var b_idempotent = ($(_thisId).attr('data-meta-idempotent')) ? true : false;\r\n    //  var b_requestmessage = ($(_thisId).attr('data-requestmessage')) ? true : false;\r\n    //  var b_responsemessage = ($(_thisId).attr('data-responsemessage')) ? true : false;\r\n    //  var _responsemessage = ($(_thisId).attr('data-responsemessage')) ? $(_thisId).attr('data-responsemessage') : \"\";\r\n    //  if (b_requestmessage) {\r\n    //    _responsemessage = $(_thisId).attr('data-responsemessage');\r\n    //    $(_thisId).html($(_thisId).attr('data-requestmessage'));\r\n    //  }\r\n\r\n    //  if (b_idempotent) {\r\n    //    $(_thisId).prop(\"disabled\", true);\r\n    //  }\r\n\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  ///IS THERE A MODAL\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  var _modal = ($(_thisId).attr('data-meta-modal')) ? true : false;\r\n    //  if (_modal) {\r\n    //    var _waitmessage = ($(_thisId).data('requestmessage') != null) ? $(_thisId).data('requestmessage') : 'Please wait';\r\n    //    var _responsemessage = ($(_thisId).data('responsemessage') != null) ? $(_thisId).data('responsemessage') : 'Success';\r\n    //    var _failmessage = ($(_thisId).data('responsemessagefail') != null) ? $(_thisId).data('responsemessagefail') : 'Failure';\r\n    //    var _messageselector = ($(_thisId).attr('data-meta-modal-message-selector') != null) ? $(_thisId).attr('data-meta-modal-message-selector') : '';\r\n\r\n    //    if (typeof $('#' + $(_thisId).attr('data-meta-modal')) != \"undefined\") {\r\n    //      $('.' + $(_thisId).attr('data-meta-modal-wait-selector')).html(_waitmessage);\r\n    //      $('#' + $(_thisId).attr('data-meta-modal')).modal();\r\n    //      //console.log('modal');\r\n    //    } else {\r\n    //      //console.log('no modal');\r\n    //    }\r\n    //  }\r\n\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  ///SHOULD WE SHOW PROGRESS BAR\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  var _progress = ($(_thisId).attr('data-meta-progress')) ? true : false;\r\n    //  var _cb = ($(_thisId).attr('data-meta-callback')) ? $(_thisId).attr('data-meta-callback') : null;\r\n    //  // find object\r\n    //  var cb = window[_cb];\r\n\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  ///IDEMPOTENT TIMESTAMP\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": \"idempotentstamp\" }).val(moment().valueOf());\r\n    //  $('#' + _form).append(input);\r\n\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  ///VALIDATE FORMS\r\n    //  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //  var _forms = ($(_thisId).data('meta-form')) ? JSON.parse($(_thisId).attr('data-meta-form')) : \"\";\r\n    //  for (let obj of _forms) {\r\n    //    if (!$('#' + obj.form).isValid(lang, conf, true)) {\r\n    //      _submit = false;\r\n    //      ///console.log('Invalid Form');\r\n    //    }\r\n    //  }\r\n\r\n    //  if (_submit) {\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///ADD OBJECT DATA ATTRIBUTES TO FORM; DATA-META ATTRIBUTES ARE EXCLUDED\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    $.each($(_thisId).data(), function (n, v) {\r\n    //      //console.log(n);\r\n    //      if (!n.startsWith(\"meta\") && n != \"dismiss\") {\r\n    //        //console.log('process');\r\n    //        ///SERIALIZE JSON OBJECTS\r\n    //        if (n.startsWith(\"json\")) {\r\n    //          var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": n.replace('json', '').toLowerCase() }).val(JSON.stringify(v));\r\n    //          $('#' + _form).append(input);\r\n    //        } else {\r\n    //          var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": n }).val(v);\r\n    //          $('#' + _form).append(input);\r\n    //        }\r\n    //      }\r\n    //    });\r\n\r\n\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///ADD INPUT ELEMENTS FROM ALL FORMS INDICATED\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    if (_forms != '') {\r\n    //      $.each(_forms, function (n, v) {\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        ///CLONE ENTIRE FORM TO HIDDEN FORM\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        $('#' + v.form + ' *').filter(':input').each(function () {\r\n    //          $(this).clone().appendTo($('#' + _form));\r\n    //        });\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        ///ADD ANY SORTABLE ELEMENTS\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        $('#' + v.form).find('[data-include-in-form] li').each(function () {\r\n    //          var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": $(this).data('fieldname') }).val($(this).data('id'));\r\n    //          $('#' + _form).append(input);\r\n    //        });\r\n\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        ///ADD DATATABLE SELECT ELEMENTS IF WITHIN FORM\r\n    //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //        $('#' + v.form).find('table[data-tableselect=\"true\"]').each(function () {\r\n    //          var fieldname = $(this).attr('data-fieldname');\r\n    //          var dataelement = $(this).attr('data-dataelement');\r\n    //          var _items = [];\r\n    //          var table = $('#' + $(this).attr('id')).DataTable();\r\n    //          for (let i = 0; i < table.rows({ selected: true }).data().length; i++) {\r\n    //            _items.push(table.rows({ selected: true }).data()[i][dataelement]);\r\n    //          }\r\n    //          var _itemsdelimited = _items.join(\",\");\r\n    //          var input = $(\"<input>\").attr({ \"type\": \"hidden\", \"name\": fieldname }).val(_itemsdelimited);\r\n    //          $('#' + _form).append(input);\r\n    //        });\r\n    //      });\r\n    //    }\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///ADD PERSISTENT ELEMENTS\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    $('#persistentData *').filter(':input').each(function () {\r\n    //      $(this).clone().appendTo($('#' + _form));\r\n    //    });\r\n\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///CALL XHR CONTROLLER\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    var formData = new FormData(document.getElementById(_form));\r\n    //    var _url = \"/xhr\";\r\n    //    var xhr = new XMLHttpRequest();\r\n    //    xhr.open('POST', _url, true);\r\n\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///ADD FILES\r\n    //    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///formData.append('file', document.querySelector('#file-input_' + _value).files[0]);\r\n\r\n    //    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    ///SHOW PROGRESS IF REQUESTED\r\n    //    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    if (_progress) {\r\n    //      xhr.upload.addEventListener('progress', function (e) {\r\n    //        percent_complete = (e.loaded / e.total) * 100;\r\n\r\n    //        var _progressselector = ($(_thisId).attr('data-meta-progress-selector')) ? $(obj).attr('data-meta-progress-selector') : \"\";\r\n    //        var _progressaccuracy = ($(_thisId).attr('data-meta-progress-accuracy')) ? $(obj).attr('data-meta-progress-accuracy') : \"1\";\r\n    //        var _progresscomplete = ($(_thisId).attr('data-meta-progress-complete')) ? $(obj).attr('data-meta-progress-complete') : \"Complete\";\r\n\r\n    //        $('.' + _progressselector).html('').show();\r\n    //        $('.' + _progressselector).html(Number(percent_complete).toFixed(_progressaccuracy) + '% complete');\r\n    //        ///$('.' + _progressselector).html(Number(percent_complete).toFixed(_progressaccuracy) + '% uploaded');\r\n    //        ///Percentage of upload completed\r\n    //        if (percent_complete == '100') {\r\n    //          $('.' + _progressselector).html(_progresscomplete);\r\n    //        }\r\n    //      });\r\n    //    }\r\n\r\n    //    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    /// SET UP A HANDLER FOR WHEN THE REQUEST FINISHES\r\n    //    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //    xhr.onload = function () {\r\n    //      if (xhr.status === 200) {\r\n    //        if (xhr.responseText.length > 0) {\r\n\r\n    //          ///VALUE TO BE SUBMITTED WITH SUBSEQUENT REQUEST SO DUPLICATE PHOTOS ARE NOT CONTINUALLY ADDED TO SERVER\r\n    //          var jsonObj = JSON.parse(xhr.responseText);\r\n    //          for (let obj of jsonObj.root) {\r\n    //            addDataset(obj, Object.keys(obj)[0]);\r\n    //          }\r\n\r\n    //          $(_thisId).prop(\"disabled\", false);\r\n    //          if (b_responsemessage) {\r\n    //            $(_thisId).html(_responsemessage);\r\n    //          }\r\n    //          //typeof cb === 'function' && cb(true);\r\n\r\n    //          //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //          ///POPULATE SORTABLE APPROPRIATELY\r\n    //          //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //          if (typeof $('#' + $(_thisId).attr('data-meta-modal')) != \"undefined\") {\r\n    //            $('#' + _messageselector).html(_responsemessage);\r\n    //            $('.' + $(_thisId).attr('data-meta-modal-wait-selector')).html('');\r\n    //            $('#' + $(_thisId).attr('data-meta-modal')).modal('hide');\r\n    //          }\r\n    //        }\r\n    //        typeof cb === 'function' && cb(true);\r\n\r\n    //      } else {\r\n    //        console.error('An error occurred!');\r\n    //        $(_thisId).prop(\"disabled\", false);\r\n    //        if (b_responsemessage) {\r\n    //          $(_thisId).html(_responsemessage);\r\n    //        }\r\n    //        if (_failmessage.length > 0) {\r\n    //          $('#' + _messageselector).html(_failmessage);\r\n    //          $('.' + $(_thisId).attr('data-meta-modal-wait-selector')).html('');\r\n    //          $('#' + $(_thisId).attr('data-meta-modal')).modal('hide');\r\n    //        }\r\n    //        typeof cb === 'function' && cb(false);\r\n\r\n    //      }\r\n    //    };\r\n\r\n    //    xhr.onreadystatechange = function () {\r\n    //      if (xhr.readyState == 4 && xhr.status == 200) {\r\n    //        if (_progress) {\r\n    //          var _progressselector = ($(_thisId).attr('data-meta-progress-selector')) ? $(obj).attr('data-meta-progress-selector') : \"\";\r\n\r\n    //          $('.' + _progressselector).html('').hide();\r\n\r\n    //          ///GET IMAGE SELECTOR\r\n    //          var imgSelector = $(_thisId).attr('data-meta-image-selector');//\r\n    //          var imgId = $(_thisId).attr('data-meta-image-id');//\r\n    //          $('#' + imgSelector).attr('src', '/assets/img/profile_photos/' + imgId + '_lg.jpg?' + new Date().getTime());\r\n    //        }\r\n    //      } else {\r\n    //        ///console.log('state! ' + xhr.readyState + ' - ' + xhr.status);\r\n    //      }\r\n    //    }\r\n\r\n\r\n    //    // Send the Data.\r\n    //    xhr.send(formData);\r\n    //    return;\r\n    //  }\r\n\r\n\r\n    //});\r\n    ///END $('body').on('click', '.form-xhr'...\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n  }\r\n\r\n  function addDataset(dataset, datasetname) {\r\n    var _match = false;\r\n    //datasets = $.grep(datasets, function (obj) {\r\n    //  $.each(obj, function (index) {\r\n    //    if (index == datasetname) {\r\n    //      _match = true;\r\n    //    }\r\n    //  });\r\n    //  if (!_match) {\r\n    //    return obj;\r\n    //  }\r\n    //});\r\n    //datasets.push(dataset);\r\n  }\r\n\r\n  function removeDataset(datasetname) {\r\n    var _match = false;\r\n    //datasets = $.grep(datasets, function (obj) {\r\n    //  $.each(obj, function (index) {\r\n    //    if (index == datasetname) {\r\n    //      _match = true;\r\n    //    }\r\n    //  });\r\n    //  if (!_match) {\r\n    //    return obj;\r\n    //  }\r\n    //});\r\n  }\r\n\r\n  function getDatasets() {\r\n    return datasets;\r\n  }\r\n\r\n  function getDatasetByName(datasetname) {\r\n    //var _match = false;\r\n    //var obj = $.grep(datasets, function (obj) {\r\n    //  $.each(obj, function (index) {\r\n    //    if (index == datasetname) {\r\n    //      _match = true;\r\n    //    }\r\n    //  });\r\n    //  if (_match) {\r\n    //    return obj;\r\n    //  }\r\n    //})[0];\r\n    //var datasetObj = (obj == null) ? [] : obj[datasetname];\r\n    //return datasetObj;\r\n  }\r\n\r\n  function handleCopyRight() {\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    ///THIS CAN BE USED TO ALWAYS KEEP COPYRIGHT YEAR CURRENT\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //jQuery(document).ready(function () {\r\n    //  //var currentYear = new Date().getFullYear();\r\n    //  //var y = new Date();\r\n    //  $('.moment-year').html(moment(new Date()).format('YYYY'));\r\n    //});\r\n  }\r\n\r\n  return {\r\n    init: function () {\r\n      console.log('hi2');\r\n      //handleXHR();\r\n    },\r\n    initCopyRight: function () {\r\n      handleCopyRight();\r\n    },\r\n    GetDatasetByName: function (datasetname) {\r\n      return getDatasetByName(datasetname);\r\n    },\r\n    RemoveDataset: function (datasetname) {\r\n      return removeDataset(datasetname);\r\n    },\r\n    SetFont: function (font) {\r\n      setFont(font);\r\n    },\r\n    CallXHR: function (xhrObj, cb) {\r\n      /*\r\n       all methods can be called here \r\n       all xhr calls enter a queue \r\n       options; can xhr be canceled from queue\r\n        updates should not be canceled so multiple updates occur \r\n        data lookups can be canceled; sync process etc\r\n          if non-parameterized xhr call being made, can cancel if one already in flight \r\n            sync to check for calendar updates; no need to make second call if one in-flight\r\n            might need to compare locatio, and date\r\n          if parameterized lookup being called then cancel the one in flight \r\n            getting slots might change based on services/staff/date\r\n       \r\n       */\r\n      _xhrprocessing = false;\r\n      var _continue = true;\r\n      try {\r\n        if (_xhrprocessing && xhrObj.queries[0].query.name == 'calendar-day-view-sync') {\r\n          ///DO NOT RUN SYNC IF XHR IS CURRENTLY BEING PROCESSED\r\n          _continue = false;\r\n        }\r\n      } catch (e) {\r\n      }\r\n      ///ABORT RUNNING XHR IF CONTINUE = TRUE;\r\n      if (_xhrprocessing && _continue) {\r\n        xhr.abort();\r\n        xhr = null;\r\n      }\r\n\r\n      ///WRAPPED IN IF BECAUSE SYNC SHOULD ONLY RUN IF NO OTHERPROCESS IS RUNNING\r\n      if (_continue) {\r\n        return handleManualXHR.apply(this, arguments);\r\n      }\r\n      //return handleManualXHR(xhrObj, cb);\r\n    },\r\n    GetDatasets: function () {\r\n      return getDatasets();\r\n    },\r\n    Help: function () {\r\n      return getHelp();\r\n    },\r\n    AddDataset: function (dataset, datasetname) {\r\n      addDataset(dataset, datasetname);\r\n    },\r\n    ApiCall: function (object) {\r\n      var apiobject = {};\r\n      apiobject.type = 'method';\r\n      apiobject.object = object;\r\n      apicontrol.start(apiobject);\r\n    },\r\n    InitDB: function () {\r\n        //    let con = xhrQueue.concat(xhrArray);\r\n      //var apiobject = {};\r\n      //apiobject.type = 'init';\r\n      //var datasetArray = ['load', 'remote', 'lazyload'];\r\n      //apiobject.object = datasetArray;\r\n      //apicontrol.start(apiobject);\r\n \r\n      InitializeObservables()//set all observable classes\r\n        .then(() => dbXHR.apply(null, ['load']))//api call to get load datasets\r\n        .then(() => HydrateDatasetList('persistent_store'))//hydrate load datasets\r\n        .then(() => HydrateDatasetList('load'))//hydrate load datasets\r\n        //.then(() => InitialHydrate())//remove initial class config so initial is separate from hydrate\r\n        .then(() => InitialRoute())//this should be fine\r\n        .then(() => dbXHR.apply(null, ['remote'])) // api call to get remote datasets\r\n        .then(() => HydrateDatasetList('remote'))//hydrate remote datasets\r\n        .then(() => dbXHR.apply(null, ['lazyload']))//api call to get lazyload datasets\r\n        .then(() => HydrateDatasetList('lazyload'))//hydrate lazyload datasets\r\n        .catch(e => {\r\n          console.log('InitDB error', e);\r\n        });\r\n    },\r\n  };\r\n}();\r\n\r\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n///INIT OBJECT\r\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\nboltObj.InitDB();\r\n             "],"names":["classRnd","Math","random","toString","slice","_rex","all","JSON","parse","stringify","this","datasets","store","persistent","meta","history","create","type","name","args","read","update","delete","alterTable","load","dataset","unload","where","save","rhandler","get","target","key","receiver","Proxy","Reflect","set","value","apply","thisArg","dbhandler","db","data","_requestparams","pointer","Observable","constructor","functionThatTakesObserver","subscribe","observer","map","projectionFunction","next","val","error","e","complete","mergeMap","anotherFunctionThatThrowsValues","fromArray","array","forEach","fromEvent","element","event","handler","addEventListener","removeEventListener","fromPromise","promise","then","catch","routecontainers","document","querySelectorAll","routecontainer","routes","route","routecontainerjson","getAttribute","states","classstates","hasAttribute","routeobj","targetobj","fullcalendarobj","fullcalendar","console","log","Array","isArray","targetroute","_ds","condition","datasource","replace","_df","datafield","views","view","style","display","getElementById","$","fullCalendar","activeelement","querySelector","active","classList","remove","add","enabled","triggers","trigger","InitializeTrigger","autoreset","triggerjson","obj","item","apiobject","object","apicontrol","start","calendarid","_thisParams","params","_thisDataObjects","dataobjects","calendardata","Object","keys","_thisDataset","elements_array","join","PopulateCalendar","Number","isInteger","length","ptr","was","historyitem","push","elements","HydrateElement","inputs","input","inputjson","inputds","inputobj","observedvalue","tagName","toLowerCase","innerHTML","cb","window","triggerobj","callbefore","function","response","targetobject","_thisDataType","datatype","_thisParameterLabel","paramname","classTo","classFrom","iconelement","targeticon","contains","classshow","classhide","classactive","classinert","filtered","grep","items","action","found","observe","navelements","navelement","thisroute","thisobj","state","p","_classenabled","classenabled","_classdisabled","classdisabled","operator","count","SetNavState","setAttribute","SanitizeNumber","toUpperCase","elementvalue","Transform","clone","node","createElement","elId","createAttribute","elName","elValue","setAttributeNode","appendChild","_target","_templatename","targetnode","attachShadow","mode","templatecss","templateContentCss","content","cloneNode","templateArray","row","template","attrClone","templateContent","append","attributes","prototype","call","pop","nodeName","toLocaleLowerCase","nodeValue","templateelements","attrKey","templateelement","_dselement","thisobserve","thisfield","itemValue","itemPrepend","prepend","itemAppend","itemPrependPad","prependpad","itemAppendPad","appendpad","attr","attrPrepend","attrValue","attrAppend","attrPrependPad","attrAppendPad","attrbustcache","bustcache","Date","now","removeattribute","removeAttribute","setattribute","attrvalue","setattributevalue","_this","actions","boltObj","buildFormData","formData","parentKey","File","objToFormData","FormData","dbXHR","Promise","resolve","reject","_thisDatasetRemote","xhrArgs","arguments","_url","_method","ds","_datasetsinit","url","method","xhrObj","queries","queryObj","query","_datasets","datasetname","resultset","_xhrprocessing","xhr","XMLHttpRequest","open","onload","status","responseText","jsonObj","root","cbArguments","cleanAttempt","cleanObj","send","queue","run","apiObj","shift","HydrateDatasetList","list","success","init","initCopyRight","GetDatasetByName","RemoveDataset","SetFont","font","setFont","CallXHR","_continue","abort","handleManualXHR","GetDatasets","Help","help","helpobj","attribute","AddDataset","ApiCall","InitDB","viewjson","default","id"],"sourceRoot":""}